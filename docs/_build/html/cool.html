
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Section 9: CLIPS Object Oriented Language &#8212; CLIPS-BPG  documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Section 10: Defmodule Construct" href="defmodule.html" />
    <link rel="prev" title="Section 8: Generic Functions" href="generic.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="defmodule.html" title="Section 10: Defmodule Construct"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="generic.html" title="Section 8: Generic Functions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CLIPS-BPG  documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="section-9-clips-object-oriented-language">
<h1>Section 9: CLIPS Object Oriented Language<a class="headerlink" href="#section-9-clips-object-oriented-language" title="Permalink to this headline">¶</a></h1>
<p>This section provides the comprehensive details of the CLIPS
Object-Oriented Language (COOL). Sections 2.3.1, 2.4.2 and 2.5.2.3
explain object references and structure. Section 2.6 gives a high level
overview of COOL. This section assumes a complete understanding of the
material given in the listed sections.</p>
<div class="section" id="background">
<h2>9.1 Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>COOL is a hybrid of features from many different OOP systems as well as
new ideas. For example, object encapsulation concepts are similar to
those in Smalltalk, and the Common Lisp Object System (CLOS) provides
the basis for multiple inheritance rules. A mixture of ideas from
Smalltalk, CLOS and other systems form the foundation of messages.
Section 8.1 explains an important contrast between the terms <strong>method</strong>
and <strong>message-handler</strong> in CLIPS.</p>
</div>
<div class="section" id="predefined-system-classes">
<h2>9.2 Predefined System Classes<a class="headerlink" href="#predefined-system-classes" title="Permalink to this headline">¶</a></h2>
<p>COOL provides seventeen system classes: OBJECT, USER, INITIAL-OBJECT,
PRIMITIVE, NUMBER, INTEGER, FLOAT, INSTANCE, INSTANCE-NAME,
INSTANCE-ADDRESS, ADDRESS, FACT-ADDRESS, EXTERNAL-ADDRESS, MULTIFIELD,
LEXEME, SYMBOL and STRING. The user may not delete or modify any of
these classes. The diagram illustrates the inheritance relationships
between these classes.</p>
<p><a href="#id1"><span class="problematic" id="id2">|image2|</span></a></p>
<p>All of these system classes except INITIAL-OBJECT are <strong>abstract</strong>
classes, which means that their only use is for inheritance (<strong>direct</strong>
instances of this class are illegal). None of these classes have slots,
and, except for the class USER, none of them have message-handlers.
However, the user may explicitly attach message-handlers to all of the
system classes except for INSTANCE, INSTANCE-ADDRESS and INSTANCE-NAME.
The OBJECT class is a superclass of all other classes, including
user-defined classes. All user-defined classes should (but are not
required to) inherit directly or indirectly from the class USER, since
this class has all of the standard system message-handlers, such as
initialization and deletion, attached to it. Section 9.4 describes these
system message-handlers.</p>
<p>The PRIMITIVE system class and all of its subclasses are provided mostly
for use in generic function method restrictions, but message-handlers
and new subclasses may be attached if desired. However, the three
primitive system classes INSTANCE, INSTANCE-ADDRESS and INSTANCE-NAME
are provided strictly for use in methods (particularly in forming
implicit methods for overloaded system functions - see section 8.5.1)
and as such cannot have subclasses or message-handlers attached to them.</p>
<p>The INITIAL-OBJECT class is provided for use by the default
<strong>definstances</strong> initial-object in creating the default instance
[initial-object] during the <strong>reset</strong> command. This system class is
<strong>concrete</strong> and <strong>reactive</strong> to pattern-matching on the LHS of rules
but is in other respects exactly like the system class USER. The
instance [initial-object] is for use by the initial-object pattern (see
section 5.4.9).</p>
</div>
<div class="section" id="defclass-construct">
<h2>9.3 Defclass Construct<a class="headerlink" href="#defclass-construct" title="Permalink to this headline">¶</a></h2>
<p>A <strong>defclass</strong> is a construct for specifying the properties (slots) and
behavior (message-handlers) of a class of objects. A defclass consists
of five elements: 1) a name, 2) a list of superclasses from which the
new class inherits slots and message-handlers, 3) a specifier saying
whether or not the creation of direct instances of the new class is
allowed, 4) a specifier saying whether or not instances of this class
can match object patterns on the LHS of rules and 5) a list of slots
specific to the new class. All user-defined classes must inherit from at
least one class, and to this end COOL provides predefined system classes
for use as a base in the derivation of new classes.</p>
<p>Any slots explicitly given in the defclass override those gotten from
inheritance. COOL applies rules to the list of superclasses to generate
a class precedence list (see section 9.3.1) for the new class. Facets
(see section 9.3.3) further describe slots. Some examples of facets
include: default value, cardinality, and types of access allowed.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Defaults are in **xxxxx**.

(defclass &lt;name&gt; [&lt;comment&gt;]
  (is-a &lt;superclass-name&gt;+)
  [&lt;role&gt;]
  [&lt;pattern-match-role&gt;]
  &lt;slot&gt;*
  &lt;handler-documentation&gt;*)

&lt;role&gt; ::= (role concrete | abstract)

&lt;pattern-match-role&gt; ::= (pattern-match reactive | non-reactive)

&lt;slot&gt; ::= (slot &lt;name&gt; &lt;facet&gt;*) | (single-slot &lt;name&gt; &lt;facet&gt;*) |
           (multislot &lt;name&gt; &lt;facet&gt;*)

&lt;facet&gt; ::= &lt;default-facet&gt; | &lt;storage-facet&gt; |
            &lt;access-facet&gt; | &lt;propagation-facet&gt; |
            &lt;source-facet&gt; | &lt;pattern-match-facet&gt; |
            &lt;visibility-facet&gt; | &lt;create-accessor-facet&gt;
            &lt;override-message-facet&gt; | &lt;constraint-attributes&gt;

&lt;default-facet&gt; ::= (default **?DERIVE** | ?NONE | &lt;expression&gt;*) |
                    (default-dynamic &lt;expression&gt;*)

&lt;storage-facet&gt; ::= (storage **local** | shared)

&lt;access-facet&gt; ::= (access **read-write** | read-only | initialize-only)

&lt;propagation-facet&gt; ::= (propagation **inherit** | no-inherit)

&lt;source-facet&gt; ::= (source **exclusive** | composite)

&lt;pattern-match-facet&gt; ::= (pattern-match **reactive** | non-reactive)

&lt;visibility-facet&gt; ::= (visibility **private** | public)

&lt;create-accessor-facet&gt; ::= (create-accessor ?NONE | read | write |
                             **read-write**)

&lt;override-message-facet&gt; ::= (override-message **?DEFAULT** | &lt;message-name&gt;)

&lt;handler-documentation&gt; ::= (message-handler &lt;name&gt; [&lt;handler-type&gt;])

&lt;handler-type&gt; ::= **primary** | around | before | after
</pre></div>
</div>
<p>Redefining an existing class deletes the current subclasses and all
associated message-handlers. An error will occur if instances of the
class or any of its subclasses exist.</p>
<div class="section" id="multiple-inheritance">
<h3>9.3.1 Multiple Inheritance<a class="headerlink" href="#multiple-inheritance" title="Permalink to this headline">¶</a></h3>
<p>If one class inherits from another class, the first class is a
<strong>subclass</strong> of the second class, and the second class is a
<strong>superclass</strong> of the first class. Every user-defined class must have at
least one direct superclass, i.e. at least one class must appear in the
<em>is-a</em> portion of the defclass. Multiple inheritance occurs when a class
has more than one direct superclass. COOL examines the direct superclass
list for a new class to establish a linear ordering called the <strong>class
precedence list</strong>. The new class inherits slots and message-handlers
from each of the classes in the class precedence list. The word
precedence implies that slots and message-handlers of a class in the
list override conflicting definitions of another class found later in
the list. A class that comes before another class in the list is said to
be more <strong>specific</strong>. All class precedence lists will terminate in the
system class OBJECT, and most (if not all) class precedence lists for
user-defined classes will terminate in the system classes USER and
OBJECT. The class precedence list can be listed using the
<strong>describe-class</strong> function (see section 13.11.1.4).</p>
<div class="section" id="multiple-inheritance-rules">
<h4>9.3.1.1 Multiple Inheritance Rules<a class="headerlink" href="#multiple-inheritance-rules" title="Permalink to this headline">¶</a></h4>
<p>COOL uses the inheritance hierarchy of the direct superclasses to
determine the class precedence list for a new class. COOL recursively
applies the following two rules to the direct superclasses:</p>
<blockquote>
<div><ol class="arabic simple">
<li>A class has higher precedence than any of its superclasses.</li>
<li>A class specifies the precedence between its direct superclasses.</li>
</ol>
</div></blockquote>
<p>If more than one class precedence list would satisfy these rules, COOL
chooses the one most similar to a strict preorder depth-first traversal.
This heuristic attempts to preserve ?family trees? to the greatest
extent possible. For example, if a child inherited genetic traits from a
mother and father, and the mother and father each inherited traits from
their parents, the child?s class precedence list would be: child mother
maternal-grandmother maternal-grandfather father paternal-grandmother
paternal-grandfather. There are other orderings which would satisfy the
rules (such as child mother father paternal-grandfather
maternal-grandmother paternal-grandmother maternal-grandfather), but
COOL chooses the one which keeps the family trees together as much as
possible.</p>
<p>Example 1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">))</span>
</pre></div>
</div>
<p>Class A directly inherits information from the class USER. The class
precedence list for A is: A USER OBJECT.</p>
<p>Example 2</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">B</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">))</span>
</pre></div>
</div>
<p>Class B directly inherits information from the class USER. The class
precedence list for B is: B USER OBJECT.</p>
<p>Example 3</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">C</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">A</span> <span class="n">B</span><span class="p">))</span>
</pre></div>
</div>
<p>Class C directly inherits information from the classes A and B. The
class precedence list for C is: C A B USER OBJECT.</p>
<p>Example 4</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">D</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">B</span> <span class="n">A</span><span class="p">))</span>
</pre></div>
</div>
<p>Class D directly inherits information from the classes B and A. The
class precedence list for D is: D B A USER OBJECT.</p>
<p>Example 5</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">E</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">A</span> <span class="n">C</span><span class="p">))</span>
</pre></div>
</div>
<p>By rule #2, A must precede C. However, C is a subclass of A and cannot
succeed A in a precedence list without violating rule #1. Thus, this is
an error.</p>
<p>Example 6</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">E</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">C</span> <span class="n">A</span><span class="p">))</span>
</pre></div>
</div>
<p>Specifying that E inherits from A is extraneous, since C inherits from
A. However, this definition does not violate any rules and is
acceptable. The class precedence list for E is: E C A B USER OBJECT.</p>
<p>Example 7</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">F</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">C</span> <span class="n">B</span><span class="p">))</span>
</pre></div>
</div>
<p>Specifying that F inherits from B is extraneous, since C inherits from
B. The class precedence list for F is: F C A B USER OBJECT. The
superclass list says B must follow C in F?s class precedence list but
<em>not</em> that B must <em>immediately</em> follow C.</p>
<p>Example 8</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">G</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">C</span> <span class="n">D</span><span class="p">))</span>
</pre></div>
</div>
<p>This is an error, for it violates rule #2. The class precedence of C
says that A should precede B, but the class precedence list of D says
the opposite.</p>
<p>Example 9</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">H</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">A</span><span class="p">))</span>

<span class="p">(</span><span class="n">defclass</span> <span class="n">I</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">B</span><span class="p">))</span>

<span class="p">(</span><span class="n">defclass</span> <span class="n">J</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">H</span> <span class="n">I</span> <span class="n">A</span> <span class="n">B</span><span class="p">))</span>
</pre></div>
</div>
<p>The respective class precedence lists of H and I are: <code class="docutils literal notranslate"><span class="pre">H</span> <span class="pre">A</span> <span class="pre">USER</span> <span class="pre">OBJECT</span></code>
and <code class="docutils literal notranslate"><span class="pre">I</span> <span class="pre">B</span> <span class="pre">USER</span> <span class="pre">OBJECT</span></code>. If J did not have A and B as direct superclasses, J
could have one of three possible class precedence lists: <code class="docutils literal notranslate"><span class="pre">J</span> <span class="pre">H</span> <span class="pre">A</span> <span class="pre">I</span> <span class="pre">B</span> <span class="pre">USER</span>
<span class="pre">OBJECT</span></code>, <code class="docutils literal notranslate"><span class="pre">J</span> <span class="pre">H</span> <span class="pre">I</span> <span class="pre">A</span> <span class="pre">B</span> <span class="pre">USER</span> <span class="pre">OBJECT</span></code> or <code class="docutils literal notranslate"><span class="pre">J</span> <span class="pre">H</span> <span class="pre">I</span> <span class="pre">B</span> <span class="pre">A</span> <span class="pre">USER</span> <span class="pre">OBJECT</span></code>. COOL would
normally pick the first list since it preserves the family trees (H A
and I B) to the greatest extent possible. However, since J inherits
directly from A and B, rule #2 dictates that the class precedence list
must be <code class="docutils literal notranslate"><span class="pre">J</span> <span class="pre">H</span> <span class="pre">I</span> <span class="pre">A</span> <span class="pre">B</span> <span class="pre">USER</span> <span class="pre">OBJECT</span></code>.</p>
<p>Usage Note</p>
<p>For most practical applications of multiple inheritance, the order in
which the superclasses are specified should not matter. If you create a
class using multiple inheritance and the order of the classes specified
in the <em>is-a</em> attribute effects the behavior of the class, you should
consider whether your program design is needlessly complex.</p>
</div>
</div>
<div class="section" id="class-specifiers">
<h3>9.3.2 Class Specifiers<a class="headerlink" href="#class-specifiers" title="Permalink to this headline">¶</a></h3>
<div class="section" id="abstract-and-concrete-classes">
<h4>9.3.2.1 Abstract and Concrete Classes<a class="headerlink" href="#abstract-and-concrete-classes" title="Permalink to this headline">¶</a></h4>
<p>An <strong>abstract</strong> class is intended for inheritance only, and no direct
instances of this class can be created. A <strong>concrete</strong> class can have
direct instances. Using the abstract role specifier in a defclass will
cause COOL to generate an error if <strong>make-instance</strong> is ever called for
this class. If the abstract or concrete descriptor for a class is not
specified, it is determined by inheritance. For the purpose of role
inheritance, system defined classes behave as concrete classes. Thus a
class which inherits from USER will be concrete if no role is specified.</p>
</div>
<div class="section" id="reactive-and-non-reactive-classes">
<h4>9.3.2.2 Reactive and Non-Reactive Classes<a class="headerlink" href="#reactive-and-non-reactive-classes" title="Permalink to this headline">¶</a></h4>
<p>Objects of a <strong>reactive</strong> class can match object patterns in a rule.
Objects of a <strong>non-reactive</strong> class cannot match object patterns in a
rule and are not considered when the list of applicable classes are
determined for an object pattern. An <strong>abstract</strong> class cannot be
<strong>reactive</strong>. If the reactive or non-reactive descriptor for a class is
not specified, it is determined by inheritance. For the purpose of
pattern-match inheritance, system defined classes behave as reactive
classes unless the inheriting class is <strong>abstract</strong>.</p>
</div>
</div>
<div class="section" id="slots">
<h3>9.3.3 Slots<a class="headerlink" href="#slots" title="Permalink to this headline">¶</a></h3>
<p>Slots are placeholders for values associated with instances of a
user-defined class. Each instance has a copy of the set of slots
specified by the immediate class as well as any obtained from
inheritance. Only available memory limits the number of slots. The name
of a slot may be any symbol with the exception of the keywords <em>is-a</em>
and <em>name</em> which are reserved for use in object patterns.</p>
<p>To determine the set of slots for an instance, the class precedence list
for the instance?s class is examined in order from most specific to most
general (left to right). A class is more specific than its superclasses.
Slots specified in any of the classes in the class precedence list are
given to the instance, with the exception of no-inherit slots (see
section 9.3.3.5). If a slot is inherited from more than one class, the
definition given by the more specific class takes precedence, with the
exception of composite slots (see section 9.3.3.6).</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">fooA</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">barA</span><span class="p">))</span>

<span class="p">(</span><span class="n">defclass</span> <span class="n">B</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">A</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">fooB</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">barB</span><span class="p">))</span>
</pre></div>
</div>
<p>The class precedence list of A is: A USER OBJECT. Instances of A will
have two slots: fooA and barA. The class precedence list of B is: B A
USER OBJECT. Instances of B will have four slots: fooB, barB, fooA and
barA.</p>
<p>Just as slots make up classes, <strong>facets</strong> make up slots. Facets describe
various features of a slot that hold true for all objects which have the
slot: default value, storage, access, inheritance propagation, source of
other facets, pattern-matching reactivity, visibility to subclass
message-handlers, the automatic creation of message-handlers to access
the slot, the name of the message to send to set the slot and constraint
information. Each object can still have its own value for a slot, with
the exception of shared slots (see section 9.3.3.3).</p>
<div class="section" id="slot-field-type">
<h4>9.3.3.1 Slot Field Type<a class="headerlink" href="#slot-field-type" title="Permalink to this headline">¶</a></h4>
<p>A slot can hold either a single-field or multifield value. By default, a
slot is single-field. The keyword <strong>multislot</strong> specifies that a slot
can hold a multifield value comprised of zero or more fields, and the
keywords <strong>slot</strong> or <strong>single-slot</strong> specify that the slot can hold one
value. Multifield slot values are stored as multifield values and can be
manipulated with the standard multifield functions, such as <strong>nth$</strong> and
<strong>length$</strong>, once they are retrieved via messages. COOL also provides
functions for setting multifield slots, such as <strong>slot-insert$</strong> (see
section 12.16.4.12.2). Single-field slots are stored as a CLIPS
primitive type, such as integer or string.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
  (multislot foo
  (default abc def ghi)))
CLIPS&gt; (make-instance a of A)
[a]
CLIPS&gt; (nth$ 2 (send [a] get-foo))
def
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="default-value-facet">
<h4>9.3.3.2 Default Value Facet<a class="headerlink" href="#default-value-facet" title="Permalink to this headline">¶</a></h4>
<p>The <strong>default</strong> and <strong>default-dynamic</strong> facets can be used to specify an
initial value given to a slot when an instance of the class is created
or initialized. By default, a slot will have a default value that is
derived from the slot?s constraint facets (see sections 9.3.3.11 and
11.5). Default values are directly assigned to slots without the use of
messages, unlike slot overrides in a <strong>make-instance</strong> call (see section
9.6.1).</p>
<p>The <strong>default</strong> facet is a static default: the specified expression is
evaluated once when the class is defined, and the result is stored with
the class. This result is assigned to the appropriate slot when a new
instance is created. If the keyword ?DERIVE is used for the default
value, then a default value is derived from the constraints for the slot
(see section 11.5 for more details). By default, the default attribute
for a slot is (default ?DERIVE). If the keyword ?NONE is used for the
default value, then the slot is not assigned a default value. Using this
keyword causes make-instance to require a slot-override for that slot
when an instance is created. Note that in CLIPS 6.0, a slot now has a
default even if one is not explicitly specified (unlike CLIPS 5.1). This
could cause different behavior for CLIPS 5.1 programs using the
initialize-instance function. The ?NONE keyword can be used to recover
the original behavior for classes.</p>
<p>The <strong>default-dynamic</strong> facet is a dynamic default: the specified
expression is evaluated every time an instance is created, and the
result is assigned to the appropriate slot.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">setgen</span> <span class="mi">1</span><span class="p">)</span>
<span class="mi">1</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">foo</span> <span class="p">(</span><span class="n">default</span><span class="o">-</span><span class="n">dynamic</span> <span class="p">(</span><span class="n">gensym</span><span class="p">))))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a1</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">a1</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a2</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">a2</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">a1</span><span class="p">]</span> <span class="n">get</span><span class="o">-</span><span class="n">foo</span><span class="p">)</span>
<span class="n">gen1</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">a2</span><span class="p">]</span> <span class="n">get</span><span class="o">-</span><span class="n">foo</span><span class="p">)</span>
<span class="n">gen2</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="storage-facet">
<h4>9.3.3.3 Storage Facet<a class="headerlink" href="#storage-facet" title="Permalink to this headline">¶</a></h4>
<p>The actual value of an instance?s copy of a slot can either be stored
with the instance or with the class. The <strong>local</strong> facet specifies that
the value be stored with the instance, and this is the default. The
<strong>shared</strong> facet specifies that the value be stored with the class. If
the slot value is locally stored, then each instance can have a separate
value for the slot. However, if the slot value is stored with the class,
all instances will have the same value for the slot. Anytime the value
is changed for a shared slot, it will be changed for all instances with
that slot.</p>
<p>A shared slot will always pick up a dynamic default value from a
defclass when an instance is created or initialized, but the shared slot
will ignore a static default value unless it does not currently have a
value. Any changes to a shared slot will cause pattern-matching for
rules to be updated for all reactive instances containing that slot.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">foo</span> <span class="p">(</span><span class="n">storage</span> <span class="n">shared</span><span class="p">)</span>
  <span class="p">(</span><span class="n">default</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">bar</span> <span class="p">(</span><span class="n">storage</span> <span class="n">shared</span><span class="p">)</span>
  <span class="p">(</span><span class="n">default</span><span class="o">-</span><span class="n">dynamic</span> <span class="mi">2</span><span class="p">))</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">woz</span> <span class="p">(</span><span class="n">storage</span> <span class="n">local</span><span class="p">)))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="nb">print</span><span class="p">)</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="p">(</span><span class="n">foo</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="n">bar</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="n">woz</span> <span class="n">nil</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">put</span><span class="o">-</span><span class="n">foo</span> <span class="mi">56</span><span class="p">)</span>
<span class="mi">56</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">put</span><span class="o">-</span><span class="n">bar</span> <span class="mi">104</span><span class="p">)</span>
<span class="mi">104</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">b</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">b</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="nb">print</span><span class="p">)</span>
<span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="p">(</span><span class="n">foo</span> <span class="mi">56</span><span class="p">)</span>
<span class="p">(</span><span class="n">bar</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="n">woz</span> <span class="n">nil</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="n">put</span><span class="o">-</span><span class="n">foo</span> <span class="mi">34</span><span class="p">)</span>
<span class="mi">34</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="n">put</span><span class="o">-</span><span class="n">woz</span> <span class="mi">68</span><span class="p">)</span>
<span class="mi">68</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="nb">print</span><span class="p">)</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="p">(</span><span class="n">foo</span> <span class="mi">34</span><span class="p">)</span>
<span class="p">(</span><span class="n">bar</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="n">woz</span> <span class="n">nil</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="nb">print</span><span class="p">)</span>
<span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="p">(</span><span class="n">foo</span> <span class="mi">34</span><span class="p">)</span>
<span class="p">(</span><span class="n">bar</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="n">woz</span> <span class="mi">68</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="access-facet">
<h4>9.3.3.4 Access Facet<a class="headerlink" href="#access-facet" title="Permalink to this headline">¶</a></h4>
<p>There are three types of access facets which can be specified for a
slot: <strong>read-write</strong>, <strong>read-only</strong>, and <strong>initialize-only</strong>. The
<strong>read-write</strong> facet is the default and says that a slot can be both
written and read. The <strong>read-only</strong> facet says the slot can only be
read; the only way to set this slot is with default facets in the class
definition. The <strong>initialize-only</strong> facet is like <strong>read-only</strong> except
that the slot can also be set by slot overrides in a <strong>make-instance</strong>
call (see section 9.6.1) and <strong>init</strong> message-handlers (see section
9.4). These privileges apply to indirect access via messages as well as
direct access within message-handler bodies (see section 9.4). Note: a
<strong>read-only</strong> slot that has a static default value will implicitly have
the <strong>shared</strong> storage facet.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
  (slot foo (access read-write))
  (slot bar (access read-only) (default abc))
  (slot woz (access initialize-only)))
CLIPS&gt;
(defmessage-handler A put-bar (?value)
  (dynamic-put (sym-cat bar) ?value))
CLIPS&gt; (make-instance a of A (bar 34))
[MSGFUN3] bar slot in [a] of A: write access denied.
[PRCCODE4] Execution halted during the actions of message-handler
put-bar primary in class A
FALSE
CLIPS&gt; (make-instance a of A (foo 34) (woz 65))
[a]
CLIPS&gt; (send [a] put-bar 1)
[MSGFUN3] bar slot in [a] of A: write access denied.
[PRCCODE4] Execution halted during the actions of message-handler
put-bar primary in class A
FALSE
CLIPS&gt; (send [a] put-woz 1)
[MSGFUN3] woz slot in [a] of A: write access denied.
[PRCCODE4] Execution halted during the actions of message-handler
put-bar primary in class A
FALSE
CLIPS&gt; (send [a] print)
[a] of A
(foo 34)
(bar abc)
(woz 65)
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="inheritance-propagation-facet">
<h4>9.3.3.5 Inheritance Propagation Facet<a class="headerlink" href="#inheritance-propagation-facet" title="Permalink to this headline">¶</a></h4>
<p>An <strong>inherit</strong> facet says that a slot in a class can be given to
instances of other classes that inherit from the first class. This is
the default. The <strong>no-inherit</strong> facet says that only direct instances of
this class will get the slot.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">foo</span> <span class="p">(</span><span class="n">propagation</span> <span class="n">inherit</span><span class="p">))</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">bar</span> <span class="p">(</span><span class="n">propagation</span> <span class="n">no</span><span class="o">-</span><span class="n">inherit</span><span class="p">)))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">defclass</span> <span class="n">B</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">A</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">b</span> <span class="n">of</span> <span class="n">B</span><span class="p">)</span>
<span class="p">[</span><span class="n">b</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="nb">print</span><span class="p">)</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="p">(</span><span class="n">foo</span> <span class="n">nil</span><span class="p">)</span>
<span class="p">(</span><span class="n">bar</span> <span class="n">nil</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="nb">print</span><span class="p">)</span>
<span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="n">of</span> <span class="n">B</span>
<span class="p">(</span><span class="n">foo</span> <span class="n">nil</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="source-facet">
<h4>9.3.3.6 Source Facet<a class="headerlink" href="#source-facet" title="Permalink to this headline">¶</a></h4>
<p>When obtaining slots from the class precedence list during instance
creation, the default behavior is to take the facets from the most
specific class that gives the slot and give default values to any
unspecified facets. This is the behavior specified by the <strong>exclusive</strong>
facet. The <strong>composite</strong> facet causes facets which are not explicitly
specified by the most specific class to be taken from the next most
specific class. Thus, in an overlay fashion, the facets of an instance?s
slot can be specified by more than one class. Note that even though
facets may be taken from superclasses, the slot is still considered to
reside in the new class for purposes of visibility (see section
9.3.3.8). One good example of a use of this feature is to pick up a slot
definition and change only its default value for a new derived class.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">multislot</span> <span class="n">foo</span> <span class="p">(</span><span class="n">access</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="p">)</span>
  <span class="p">(</span><span class="n">default</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="p">)))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">B</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">A</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">foo</span> <span class="p">(</span><span class="n">source</span> <span class="n">composite</span><span class="p">)</span> <span class="p">;</span> <span class="n">multiple</span> <span class="ow">and</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span>
  <span class="p">;</span> <span class="kn">from</span> <span class="nn">class</span> <span class="n">A</span>
  <span class="p">(</span><span class="n">default</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span><span class="p">)))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">describe</span><span class="o">-</span><span class="k">class</span> <span class="nc">B</span><span class="p">)</span>
<span class="o">================================================================================</span>
<span class="o">********************************************************************************</span>
<span class="n">Concrete</span><span class="p">:</span> <span class="n">direct</span> <span class="n">instances</span> <span class="n">of</span> <span class="n">this</span> <span class="k">class</span> <span class="nc">can</span> <span class="n">be</span> <span class="n">created</span><span class="o">.</span>
<span class="n">Reactive</span><span class="p">:</span> <span class="n">direct</span> <span class="n">instances</span> <span class="n">of</span> <span class="n">this</span> <span class="k">class</span> <span class="nc">can</span> <span class="n">match</span> <span class="n">defrule</span> <span class="n">patterns</span><span class="o">.</span>
<span class="n">Direct</span> <span class="n">Superclasses</span><span class="p">:</span> <span class="n">A</span>
<span class="n">Inheritance</span> <span class="n">Precedence</span><span class="p">:</span> <span class="n">B</span> <span class="n">A</span> <span class="n">USER</span> <span class="n">OBJECT</span>
<span class="n">Direct</span> <span class="n">Subclasses</span><span class="p">:</span>
<span class="o">--------------------------------------------------------------------------------</span>
<span class="n">SLOTS</span> <span class="p">:</span> <span class="n">FLD</span> <span class="n">DEF</span> <span class="n">PRP</span> <span class="n">ACC</span> <span class="n">STO</span> <span class="n">MCH</span> <span class="n">SRC</span> <span class="n">VIS</span> <span class="n">CRT</span> <span class="n">OVRD</span><span class="o">-</span><span class="n">MSG</span> <span class="n">SOURCE</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="n">foo</span> <span class="p">:</span> <span class="n">MLT</span> <span class="n">STC</span> <span class="n">INH</span> <span class="n">R</span> <span class="n">SHR</span> <span class="n">RCT</span> <span class="n">CMP</span> <span class="n">PRV</span> <span class="n">R</span> <span class="n">NIL</span> <span class="n">A</span> <span class="n">B</span>
<span class="n">Constraint</span> <span class="n">information</span> <span class="k">for</span> <span class="n">slots</span><span class="p">:</span>
<span class="n">SLOTS</span> <span class="p">:</span> <span class="n">SYM</span> <span class="n">STR</span> <span class="n">INN</span> <span class="n">INA</span> <span class="n">EXA</span> <span class="n">FTA</span> <span class="n">INT</span> <span class="n">FLT</span>
<span class="n">foo</span> <span class="p">:</span> <span class="o">+</span> <span class="o">+</span> <span class="o">+</span> <span class="o">+</span> <span class="o">+</span> <span class="o">+</span> <span class="o">+</span> <span class="o">+</span> <span class="n">RNG</span><span class="p">:[</span><span class="o">-</span><span class="n">oo</span><span class="o">..+</span><span class="n">oo</span><span class="p">]</span> <span class="n">CRD</span><span class="p">:[</span><span class="mf">0.</span><span class="o">.+</span><span class="n">oo</span><span class="p">]</span>
<span class="o">--------------------------------------------------------------------------------</span>
<span class="n">Recognized</span> <span class="n">message</span><span class="o">-</span><span class="n">handlers</span><span class="p">:</span>
<span class="n">init</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">delete</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">create</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="nb">print</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">direct</span><span class="o">-</span><span class="n">modify</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">message</span><span class="o">-</span><span class="n">modify</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">direct</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">message</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">get</span><span class="o">-</span><span class="n">foo</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span>
<span class="n">get</span><span class="o">-</span><span class="n">foo</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">B</span>
<span class="o">********************************************************************************</span>
<span class="o">================================================================================</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="pattern-match-reactivity-facet">
<h4>9.3.3.7 Pattern-Match Reactivity Facet<a class="headerlink" href="#pattern-match-reactivity-facet" title="Permalink to this headline">¶</a></h4>
<p>Normally, any change to a slot of an instance will be considered as a
change to the instance for purposes of pattern-matching. However, it is
possible to indicate that changes to a slot of an instance should not
cause pattern-matching. The <strong>reactive</strong> facet specifies that changes to
a slot trigger pattern-matching, and this is the default. The
<strong>non-reactive</strong> facet specifies that changes to a slot do not affect
pattern-matching.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
  (slot foo (pattern-match non-reactive)))
CLIPS&gt;
(defclass B (is-a USER)
  (slot foo))
CLIPS&gt;
(defrule Create
  ?ins&lt;-(object (is-a A | B))
  =&gt;
  (printout t &quot;Create &quot; (instance-name ?ins) crlf))
CLIPS&gt;
(defrule Foo-Access
  ?ins&lt;-(object (is-a A | B) (foo ?))
  =&gt;
  (printout t &quot;Foo-Access &quot; (instance-name ?ins) crlf))
CLIPS&gt; (make-instance a of A)
[a]
CLIPS&gt; (make-instance b of B)
[b]
CLIPS&gt; (run)
Create [b]
Foo-Access [b]
Create [a]
CLIPS&gt; (send [a] put-foo 1)
1
CLIPS&gt; (send [b] put-foo 1)
1
CLIPS&gt; (run)
Foo-Access [b]
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="visibility-facet">
<h4>9.3.3.8 Visibility Facet<a class="headerlink" href="#visibility-facet" title="Permalink to this headline">¶</a></h4>
<p>Normally, only message-handlers attached to the class in which a slot is
defined may directly access the slot. However, it is possible to allow
message-handlers attached to superclasses or subclasses which inherit
the slot to directly access the slot as well. Declaring the
<strong>visibility</strong> facet to be <strong>private</strong> specifies that only the
message-handlers of the defining class may directly access the slot, and
this is the default. Declaring the <strong>visibility</strong> facet to be <strong>public</strong>
specifies that the message-handlers and subclasses that inherit the slot
and superclasses may also directly access the slot.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
  (slot foo (visibility private)))
CLIPS&gt;
(defclass B (is-a A))
CLIPS&gt;
(defmessage-handler B get-foo ()
  ?self:foo)
[MSGFUN6] Private slot foo of class A cannot be accessed directly by
handlers attached to class B
[PRCCODE3] Undefined variable self:foo referenced in message-handler.
ERROR:
(defmessage-handler MAIN::B get-foo
()
?self:foo)
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="create-accessor-facet">
<h4>9.3.3.9 Create-Accessor Facet<a class="headerlink" href="#create-accessor-facet" title="Permalink to this headline">¶</a></h4>
<p>The <strong>create-accessor</strong> facet instructs CLIPS to automatically create
<em>explicit</em> message-handlers for reading and/or writing a slot. By
default, implicit slot-accessor message-handlers are created for every
slot. While these message-handlers are real message-handlers and can be
manipulated as such, they have no pretty-print form and cannot be
directly modified by the user.</p>
<p>If the value <strong>?NONE</strong> is specified for the facet, no message-handlers
are created.</p>
<p>If the value <strong>read</strong> is specified for the facet, CLIPS creates the
following message-handler:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(defmessage-handler &lt;class&gt; get-&lt;slot-name&gt; primary ()
  ?self:&lt;slot-name&gt;)
</pre></div>
</div>
<p>If the value <strong>write</strong> is specified for the facet, CLIPS creates the
following message-handler for single-field slots:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(defmessage-handler &lt;class&gt; put-&lt;slot-name&gt; primary (?value)
  (bind ?self:&lt;slot-name&gt; ?value)
</pre></div>
</div>
<p>or the following message-handler for multifield slots:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(defmessage-handler &lt;class&gt; put-&lt;slot-name&gt; primary ($?value)
  (bind ?self:&lt;slot-name&gt; ?value)
</pre></div>
</div>
<p>If the value <strong>read-write</strong> is specified for the facet, both the get-
and one of the put- message-handlers are created.</p>
<p>If accessors are required that do not use static slot references (see
sections 9.4.2, 9.6.3 and 9.6.4), then user must define them explicitly
with the defmessage-handler construct.</p>
<p>The <strong>access</strong> facet affects the default value for the
<strong>create-accessor</strong> facet. If the <strong>access</strong> facet is <strong>read-write</strong>,
then the default value for the <strong>create-accessor</strong> facet is
<strong>read-write</strong>. If the <strong>access</strong> facet is <strong>read-only</strong>, then the
default value is <strong>read</strong>. If the access facet is <strong>initialize-only</strong>,
then the default is <strong>?NONE</strong>.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">foo</span> <span class="p">(</span><span class="n">create</span><span class="o">-</span><span class="n">accessor</span> <span class="n">write</span><span class="p">))</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">bar</span> <span class="p">(</span><span class="n">create</span><span class="o">-</span><span class="n">accessor</span> <span class="n">read</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span> <span class="p">(</span><span class="n">foo</span> <span class="mi">36</span><span class="p">))</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">b</span> <span class="n">of</span> <span class="n">A</span> <span class="p">(</span><span class="n">bar</span> <span class="mi">45</span><span class="p">))</span>
<span class="p">[</span><span class="n">MSGFUN1</span><span class="p">]</span> <span class="n">No</span> <span class="n">applicable</span> <span class="n">primary</span> <span class="n">message</span><span class="o">-</span><span class="n">handlers</span> <span class="n">found</span> <span class="k">for</span> <span class="n">put</span><span class="o">-</span><span class="n">bar</span><span class="o">.</span>
<span class="n">FALSE</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="override-message-facet">
<h4>9.3.3.10 Override-Message Facet<a class="headerlink" href="#override-message-facet" title="Permalink to this headline">¶</a></h4>
<p>There are several COOL support functions that set slots via use of
message-passing, e.g., <strong>make-instance</strong>, <strong>initialize-instance</strong>,
<strong>message-modify-instance</strong> and <strong>message-duplicate-instance</strong>. By
default, all these functions attempt to set a slot with the message
called <strong>put-&lt;slot-name&gt;</strong>. However, if the user has elected not to use
standard slot-accessors and wishes these functions to be able to perform
slot-overrides, then the <strong>override-message</strong> facet can be used to
indicate what message to send instead.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
  (slot special (override-message special-put)))
CLIPS&gt;
(defmessage-handler A special-put primary (?value)
  (bind ?self:special ?value))
CLIPS&gt; (watch messages)
CLIPS&gt; (make-instance a of A (special 65))
MSG &gt;&gt; create ED:1 (&lt;Instance-a&gt;)
MSG &lt;&lt; create ED:1 (&lt;Instance-a&gt;)
MSG &gt;&gt; special-put ED:1 (&lt;Instance-a&gt; 65)
MSG &lt;&lt; special-put ED:1 (&lt;Instance-a&gt; 65)
MSG &gt;&gt; init ED:1 (&lt;Instance-a&gt;)
MSG &lt;&lt; init ED:1 (&lt;Instance-a&gt;)
[a]
CLIPS&gt; (unwatch messages)
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="constraint-facets">
<h4>9.3.3.11 Constraint Facets<a class="headerlink" href="#constraint-facets" title="Permalink to this headline">¶</a></h4>
<p>The syntax and functionality of single and multifield constraint facets
(attributes) are described in detail in Section 11. Static and dynamic
constraint checking for classes and their instances is supported. Static
checking is performed when constructs or commands that specify slot
information are being parsed. Object patterns used on the LHS of a rule
are also checked to determine if constraint conflicts exist among
variables used in more that one slot. Errors for inappropriate values
are immediately signaled. Static checking is enabled by default. This
behavior can be changed using the <strong>set-static-constraint-checking</strong>
function. Dynamic checking is also supported. If dynamic checking is
enabled, then new instances have their values checked whenever they are
set (e.g. initialization, slot-overrides, and put- access). This dynamic
checking is disabled by default. This behavior can be changed using the
<strong>set-dynamic-constraint-checking</strong> function. If an violation occurs
when dynamic checking is being performed, then execution will be halted.</p>
<p>Regardless of whether static or dynamic checking is enabled, multifield
values can never be stored in single-field slots. Single-field values
are converted to a multifield value of length one when storing in a
multifield slot. In addition, the evaluation of a function that has no
return value is always illegal as a slot value.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">multislot</span> <span class="n">foo</span> <span class="p">(</span><span class="nb">type</span> <span class="n">SYMBOL</span><span class="p">)</span>
  <span class="p">(</span><span class="n">cardinality</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span> <span class="p">(</span><span class="n">foo</span> <span class="mi">45</span><span class="p">))</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">dynamic</span><span class="o">-</span><span class="n">constraint</span><span class="o">-</span><span class="n">checking</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">FALSE</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span> <span class="p">(</span><span class="n">foo</span> <span class="n">red</span> <span class="mf">5.0</span><span class="p">))</span>
<span class="p">[</span><span class="n">CSTRNCHK1</span><span class="p">]</span> <span class="p">(</span><span class="n">red</span> <span class="mf">5.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">slot</span> <span class="n">foo</span> <span class="n">of</span> <span class="n">instance</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">put</span><span class="o">-</span><span class="n">foo</span>
<span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">match</span> <span class="n">the</span> <span class="n">allowed</span> <span class="n">types</span><span class="o">.</span>
<span class="p">[</span><span class="n">PRCCODE4</span><span class="p">]</span> <span class="n">Execution</span> <span class="n">halted</span> <span class="n">during</span> <span class="n">the</span> <span class="n">actions</span> <span class="n">of</span> <span class="n">message</span><span class="o">-</span><span class="n">handler</span>
<span class="n">put</span><span class="o">-</span><span class="n">foo</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span>
<span class="n">FALSE</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span> <span class="p">(</span><span class="n">foo</span> <span class="n">red</span><span class="p">))</span>
<span class="p">[</span><span class="n">CSTRNCHK1</span><span class="p">]</span> <span class="p">(</span><span class="n">red</span><span class="p">)</span> <span class="k">for</span> <span class="n">slot</span> <span class="n">foo</span> <span class="n">of</span> <span class="n">instance</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">put</span><span class="o">-</span><span class="n">foo</span> <span class="n">primary</span>
<span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">satisfy</span> <span class="n">the</span> <span class="n">cardinality</span> <span class="n">restrictions</span><span class="o">.</span>
<span class="p">[</span><span class="n">PRCCODE4</span><span class="p">]</span> <span class="n">Execution</span> <span class="n">halted</span> <span class="n">during</span> <span class="n">the</span> <span class="n">actions</span> <span class="n">of</span> <span class="n">message</span><span class="o">-</span><span class="n">handler</span>
<span class="n">put</span><span class="o">-</span><span class="n">foo</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span>
<span class="n">FALSE</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="message-handler-documentation">
<h3>9.3.4 Message-handler Documentation<a class="headerlink" href="#message-handler-documentation" title="Permalink to this headline">¶</a></h3>
<p>COOL allows the user to forward declare the message-handlers for a class
within the defclass statement. These declarations are for documentation
only and are ignored by CLIPS. The defmessage-handler construct must be
used to actually add message-handlers to a class. Message-handlers can
later be added which are not documented in the defclass.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass rectangle (is-a USER)
  (slot side-a (default 1))
  (slot side-b (default 1))
  (message-handler find-area))
CLIPS&gt;
(defmessage-handler rectangle find-area ()
  (* ?self:side-a ?self:side-b))
CLIPS&gt;
(defmessage-handler rectangle print-area ()
  (printout t (send ?self find-area) crlf))
CLIPS&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="defmessage-handler-construct">
<h2>9.4 Defmessage-handler Construct<a class="headerlink" href="#defmessage-handler-construct" title="Permalink to this headline">¶</a></h2>
<p>Objects are manipulated by sending them messages via the function
<strong>send</strong>. The result of a message is a useful return-value or
side-effect. A <strong>defmessage-handler</strong> is a construct for specifying the
behavior of a class of objects in response to a particular message. The
implementation of a message is made up of pieces of procedural code
called message-handlers (or handlers for short). Each class in the class
precedence list of an object?s class can have handlers for a message. In
this way, the object?s class and all its superclasses share the labor of
handling the message. Each class?s handlers handle the part of the
message that is appropriate to that class. Within a class, the handlers
for a particular message can be further subdivided into four types or
categories: <strong>primary</strong>, <strong>before</strong>, <strong>after</strong> and <strong>around</strong>. The
intended purposes of each type are summarized in the chart below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Type</strong></th>
<th class="head"><strong>Role for the Class</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>primary</td>
<td>Performs the majority of the work for the message</td>
</tr>
<tr class="row-odd"><td>before</td>
<td>Does auxiliary work for a message before the primary handler executes</td>
</tr>
<tr class="row-even"><td>after</td>
<td>Does auxiliary work for a message after the primary handler executes</td>
</tr>
<tr class="row-odd"><td>around</td>
<td>Sets up an environment for the execution of the rest of the handlers</td>
</tr>
</tbody>
</table>
<p>Before and after handlers are for side-effects only; their return values
are always ignored. Before handlers execute before the primary ones, and
after message-handlers execute after the primary ones. The return value
of a message is generally given by the primary message-handlers, but
around handlers can also return a value. Around message-handlers allow
the user to wrap code around the rest of the handlers. They begin
execution before the other handlers and pick up again after all the
other message-handlers have finished.</p>
<p>A primary handler provides the part of the message implementation which
is most specific to an object, and thus the primary handler attached to
the class closest to the immediate class of the object overrides other
primary handlers. Before and after handlers provide the ability to pick
up behavior from classes that are more general than the immediate class
of the object, thus the message implementation uses all handlers of this
type from all the classes of an object. When only the roles of the
handlers specify which handlers get executed and in what order, the
message is said to be <strong>declaratively</strong> implemented. However, some
message implementations may not fit this model well. For example, the
results of more than one primary handler may be needed. In cases like
this, the handlers themselves must take part in deciding which handlers
get executed and in what order. This is called the <strong>imperative</strong>
technique. Around handlers provide imperative control over all other
types of handlers except more specific around handlers. Around handlers
can change the environment in which other handlers execute and modify
the return value for the entire message. A message implementation should
use the declarative technique if at all possible because this allows the
handlers to be more independent and modular.</p>
<p>A defmessage-handler is comprised of seven elements: 1) a class name to
which to attach the handler (the class must have been previously
defined), 2) a message name to which the handler will respond, 3) an
optional type (the default is primary), 4) an optional comment, 5) a
list of parameters that will be passed to the handler during execution,
6) an optional wildcard parameter and 7) a series of expressions which
are executed in order when the handler is called. The return-value of a
message-handler is the evaluation of the last expression in the body.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Defaults</span> <span class="n">are</span> <span class="ow">in</span> <span class="o">**</span><span class="n">xxxx</span><span class="o">**.</span>

<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="o">&lt;</span><span class="n">class</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">message</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="o">&lt;</span><span class="n">handler</span><span class="o">-</span><span class="nb">type</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">comment</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">(</span><span class="o">&lt;</span><span class="n">parameter</span><span class="o">&gt;*</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">wildcard</span><span class="o">-</span><span class="n">parameter</span><span class="o">&gt;</span><span class="p">])</span>
  <span class="o">&lt;</span><span class="n">action</span><span class="o">&gt;*</span><span class="p">)</span>

<span class="o">&lt;</span><span class="n">handler</span><span class="o">-</span><span class="nb">type</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="n">around</span> <span class="o">|</span> <span class="n">before</span> <span class="o">|</span> <span class="o">**</span><span class="n">primary</span><span class="o">**</span> <span class="o">|</span> <span class="n">after</span>

<span class="o">&lt;</span><span class="n">parameter</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="o">&lt;</span><span class="n">single</span><span class="o">-</span><span class="n">field</span><span class="o">-</span><span class="n">variable</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">wildcard</span><span class="o">-</span><span class="n">parameter</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="o">&lt;</span><span class="n">multifield</span><span class="o">-</span><span class="n">variable</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Message-handlers are uniquely identified by class, name and type.
Message-handlers are never called directly. When the user sends a
message to an object, CLIPS selects and orders the applicable
message-handlers attached to the object?s class(es) and then executes
them. This process is termed the <strong>message dispatch</strong>.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">A</span> <span class="n">delete</span> <span class="n">before</span> <span class="p">()</span>
  <span class="p">(</span><span class="n">printout</span> <span class="n">t</span> <span class="s2">&quot;Deleting an instance of the class A...&quot;</span> <span class="n">crlf</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">USER</span> <span class="n">delete</span> <span class="n">after</span> <span class="p">()</span>
  <span class="p">(</span><span class="n">printout</span> <span class="n">t</span> <span class="s2">&quot;System completed deletion of an instance.&quot;</span>
<span class="n">crlf</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">watch</span> <span class="n">instances</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="o">==&gt;</span> <span class="n">instance</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">delete</span><span class="p">)</span>
<span class="n">Deleting</span> <span class="n">an</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">the</span> <span class="k">class</span> <span class="nc">A</span><span class="o">...</span>
<span class="o">&lt;==</span> <span class="n">instance</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="n">System</span> <span class="n">completed</span> <span class="n">deletion</span> <span class="n">of</span> <span class="n">an</span> <span class="n">instance</span><span class="o">.</span>
<span class="n">TRUE</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">unwatch</span> <span class="n">instances</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="section" id="message-handler-parameters">
<h3>9.4.1 Message-handler Parameters<a class="headerlink" href="#message-handler-parameters" title="Permalink to this headline">¶</a></h3>
<p>A message-handler may accept <em>exactly</em> or <em>at least</em> a specified number
of arguments, depending on whether a wildcard parameter is used or not.
The regular parameters specify the minimum number of arguments that must
be passed to the handler. Each of these parameters may be referenced
like a normal single-field variable within the actions of the handler.
If a wildcard parameter is present, the handler may be passed any number
of arguments greater than or equal to the minimum. If no wildcard
parameter is present, then the handler must be passed exactly the number
of arguments specified by the regular parameters. All arguments to a
handler that do not correspond to a regular parameter are grouped into a
multifield value that can be referenced by the wildcard parameter. The
standard CLIPS multifield functions, such as <strong>length$</strong> and
<strong>expand$</strong>, can be applied to the wildcard parameter.</p>
<p>Handler parameters have no bearing on the applicability of a handler to
a particular message (see section 9.5.1). However, if the number of
arguments is inappropriate, a message execution error (see section
9.5.4) will be generated when the handler is called. Thus, the number of
arguments accepted should be consistent for all message-handlers
applicable to a particular message.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass CAR (is-a USER)
  (slot front-seat)
  (multislot trunk)
  (slot trunk-count))
CLIPS&gt;
(defmessage-handler CAR put-items-in-car (?item $?rest)
  (bind ?self:front-seat ?item)
  (bind ?self:trunk ?rest)
  (bind ?self:trunk-count (length$ ?rest)))
CLIPS&gt; (make-instance Pinto of CAR)
[Pinto]
CLIPS&gt; (send [Pinto] put-items-in-car bag-of-groceries tire suitcase)
2
CLIPS&gt; (send [Pinto] print)
[Pinto] of CAR
(front-seat bag-of-groceries)
(trunk tire suitcase)
(trunk-count 2)
CLIPS&gt;
</pre></div>
</div>
<div class="section" id="active-instance-parameter">
<h4>9.4.1.1 Active Instance Parameter<a class="headerlink" href="#active-instance-parameter" title="Permalink to this headline">¶</a></h4>
<p>The term <strong>active instance</strong> refers to an instance that is responding to
a message. All message-handlers have an implicit parameter called
<strong>?self</strong> which binds the active instance for a message. This parameter
name is reserved and cannot be explicitly listed in the
message-handler?s parameters, nor can it be rebound within the body of a
message-handler.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt; (defclass A (is-a USER))
CLIPS&gt; (make-instance a of A)
[a]
CLIPS&gt;
(defmessage-handler A print-args (?a ?b $?c)
  (printout t (instance-name ?self) &quot; &quot; ?a &quot; &quot; ?b
   &quot; and &quot; (length$ ?c) &quot; extras: &quot; ?c crlf))
CLIPS&gt; (send [a] print-args 1 2)
[a] 1 2 and 0 extras: ()
CLIPS&gt; (send [a] print-args a b c d)
[a] a b and 2 extras: (c d)
CLIPS&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="message-handler-actions">
<h3>9.4.2 Message-handler Actions<a class="headerlink" href="#message-handler-actions" title="Permalink to this headline">¶</a></h3>
<p>The body of a message-handler is a sequence of expressions that are
executed in order when the handler is called. The return value of the
message-handler is the result of the evaluation of the last expression
in the body.</p>
<p>Handler actions may <em>directly</em> manipulate slots of the active instance.
Normally, slots can only be manipulated by sending the object
slot-accessor messages (see sections 9.3.3.9 and 9.4.3). However,
handlers are considered part of the encapsulation (see section 2.6.2) of
an object, and thus can directly view and change the slots of the
object. There are several functions which operate implicitly on the
active instance (without the use of messages) and can only be called
from within a message-handler. These functions are discussed in section
12.16.</p>
<p>A shorthand notation is provided for accessing slots of the active
instance from within a message-handler.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>?self:&lt;slot-name&gt;
</pre></div>
</div>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
  (slot foo (default 1))
  (slot bar (default 2)))
CLIPS&gt;
(defmessage-handler A print-all-slots ()
  (printout t ?self:foo &quot; &quot; ?self:bar crlf))
CLIPS&gt; (make-instance a of A)
[a]
CLIPS&gt; (send [a] print-all-slots)
1 2
CLIPS&gt;
</pre></div>
</div>
<p>The <strong>bind</strong> function can also take advantage of this shorthand notation
to set the value of a slot.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(bind ?self:&lt;slot-name&gt; &lt;value&gt;*)
</pre></div>
</div>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt;
(defmessage-handler A set-foo (?value)
(bind ?self:foo ?value))

CLIPS&gt; (send [a] set-foo 34)
34
CLIPS&gt;
</pre></div>
</div>
<p>Direct slot accesses are statically bound to the appropriate slot in the
defclass when the message-handler is defined. Care must be taken when
these direct slot accesses can be executed as the result of a message
sent to an instance of a subclass of the class to which the
message-handler is attached. If the subclass has redefined the slot, the
direct slot access contained in the message-handler attached to the
superclass will fail. That message-handler accesses the slot in the
superclass, not the subclass.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
  (slot foo (create-accessor read)))
CLIPS&gt;
(defclass B (is-a A)
  (slot foo (create-accessor ?NONE)))
CLIPS&gt; (make-instance b of B)
[b]
CLIPS&gt; (send [b] get-foo)
[MSGPASS3] Static reference to slot foo of class A does not apply to [b]
of B
[PRCCODE4] Execution halted during the actions of message-handler
get-foo primary in class A
FALSE
CLIPS&gt;
</pre></div>
</div>
<p>In order for direct slot accesses in a superclass message-handler to
apply to new versions of the slot in subclasses, the dynamic-put and
dynamic-get (see sections 12.16.4.10 and 12.16.4.11) must be used.
However, the subclass slot must have public visibility for this to work
(see section 9.3.3.8).</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
  (slot foo (create-accessor ?NONE)))
CLIPS&gt;
(defmessage-handler A get-foo ()
  (dynamic-get foo))
CLIPS&gt;
(defclass B (is-a A)
  (role concrete)
  (slot foo (visibility public)))
CLIPS&gt; (make-instance b of B)
[b]
CLIPS&gt; (send [b] get-foo)
nil
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="daemons">
<h3>9.4.3 Daemons<a class="headerlink" href="#daemons" title="Permalink to this headline">¶</a></h3>
<p>Daemons are pieces of code which execute implicitly whenever some basic
action is taken upon an instance, such as initialization, deletion, or
reading and writing of slots. All these basic actions are implemented
with primary handlers attached to the class of the instance. Daemons may
be easily implemented by defining other types of message-handlers, such
as before or after, which will recognize the same messages. These pieces
of code will then be executed whenever the basic actions are performed
on the instance.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">A</span> <span class="n">init</span> <span class="n">before</span> <span class="p">()</span>
  <span class="p">(</span><span class="n">printout</span> <span class="n">t</span> <span class="s2">&quot;Initializing a new instance of class A...&quot;</span>
<span class="n">crlf</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="n">Initializing</span> <span class="n">a</span> <span class="n">new</span> <span class="n">instance</span> <span class="n">of</span> <span class="k">class</span> <span class="nc">A</span><span class="o">...</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="predefined-system-message-handlers">
<h3>9.4.4 Predefined System Message-handlers<a class="headerlink" href="#predefined-system-message-handlers" title="Permalink to this headline">¶</a></h3>
<p>CLIPS defines eight primary message-handlers that are attached to the
class USER. These handlers cannot be deleted or modified.</p>
<div class="section" id="instance-initialization">
<h4>9.4.4.1 Instance Initialization<a class="headerlink" href="#instance-initialization" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">USER</span> <span class="n">init</span> <span class="n">primary</span> <span class="p">())</span>
</pre></div>
</div>
<p>This handler is responsible for initializing instances with class
default values after creation. The <strong>make-instance</strong> and
<strong>initialize-instance</strong> functions send the <strong>init</strong> message to an
instance (see sections 9.6.1 and 9.6.2); the user should never send this
message directly. This handler is implemented using the <strong>init-slots</strong>
function (see section 12.13). User-defined <strong>init</strong> handlers should not
prevent the system message-handler from responding to an <strong>init</strong>
message (see section 9.5.3).</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">CAR</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">price</span> <span class="p">(</span><span class="n">default</span> <span class="mi">75000</span><span class="p">))</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">model</span> <span class="p">(</span><span class="n">default</span> <span class="n">Corniche</span><span class="p">)))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">watch</span> <span class="n">messages</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">watch</span> <span class="n">message</span><span class="o">-</span><span class="n">handlers</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span> <span class="n">of</span> <span class="n">CAR</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">create</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">create</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">create</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">create</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">init</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">init</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">init</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">init</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="p">[</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="instance-deletion">
<h4>9.4.4.2 Instance Deletion<a class="headerlink" href="#instance-deletion" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">USER</span> <span class="n">delete</span> <span class="n">primary</span> <span class="p">())</span>
</pre></div>
</div>
<p>This handler is responsible for deleting an instance from the system.
The user must directly send a <strong>delete</strong> message to an instance.
User-defined <strong>delete</strong> message-handlers should not prevent the system
message-handler from responding to a <strong>delete</strong> message (see section
9.5.3). The handler returns the symbol TRUE if the instance was
successfully deleted, otherwise it returns the symbol FALSE.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="p">]</span> <span class="n">delete</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">delete</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">delete</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">delete</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Stale</span> <span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">delete</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Stale</span> <span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">TRUE</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="instance-display">
<h4>9.4.4.3 Instance Display<a class="headerlink" href="#instance-display" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">USER</span> <span class="nb">print</span> <span class="n">primary</span> <span class="p">())</span>
</pre></div>
</div>
<p>This handler prints out slots and their values for an instance.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span> <span class="n">of</span> <span class="n">CAR</span><span class="p">)</span>

    <span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">create</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">create</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
    <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">create</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
    <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">create</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">init</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">init</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
    <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">init</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
    <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">init</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="p">[</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="p">]</span>
    <span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="p">]</span> <span class="nb">print</span><span class="p">)</span>
    <span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="nb">print</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="nb">print</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
    <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="p">[</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="p">]</span> <span class="n">of</span> <span class="n">CAR</span>
    <span class="p">(</span><span class="n">price</span> <span class="mi">75000</span><span class="p">)</span>
    <span class="p">(</span><span class="n">model</span> <span class="n">Corniche</span><span class="p">)</span>
    <span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="nb">print</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
    <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="nb">print</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">Rolls</span><span class="o">-</span><span class="n">Royce</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">unwatch</span> <span class="n">messages</span><span class="p">)</span>
    <span class="n">CLIPS</span><span class="o">.</span> <span class="p">(</span><span class="n">unwatch</span> <span class="n">message</span><span class="o">-</span><span class="n">handlers</span><span class="p">)</span>
    <span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="directly-modifying-an-instance">
<h4>9.4.4.4 Directly Modifying an Instance<a class="headerlink" href="#directly-modifying-an-instance" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(defmessage-handler USER direct-modify primary
  (?slot-override-expressions))
</pre></div>
</div>
<p>This handler modifies the slots of an instance directly rather than
using put- override messages to place the slot values. The slot-override
expressions are passed as an EXTERNAL_ADDRESS data object to the
direct-modify handler. This message is used by the functions
<strong>modify-instance</strong> and <strong>active-modify-instance</strong>.</p>
<p>Example</p>
<p>The following around message-handler could be used to insure that all
modify message slot-overrides are handled using put- messages.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(defmessage-handler USER direct-modify around (?overrides)
  (send ?self message-modify ?overrides))
</pre></div>
</div>
</div>
<div class="section" id="modifying-an-instance-using-messages">
<h4>9.4.4.5 Modifying an Instance using Messages<a class="headerlink" href="#modifying-an-instance-using-messages" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(defmessage-handler USER message-modify primary
  (?slot-override-expressions)
</pre></div>
</div>
<p>This handler modifies the slots of an instance using put- messages for
each slot update. The slot-override expressions are passed as an
EXTERNAL_ADDRESS data object to the message-modify handler. This message
is used by the functions <strong>message-modify-instance</strong> and
<strong>active-message-modify-instance</strong>.</p>
</div>
<div class="section" id="directly-duplicating-an-instance">
<h4>9.4.4.6 Directly Duplicating an Instance<a class="headerlink" href="#directly-duplicating-an-instance" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(defmessage-handler USER direct-duplicate primary
  (?new-instance-name ?slot-override-expressions))
</pre></div>
</div>
<p>This handler duplicates an instance without using put- messages to
assign the slot-overrides. Slot values from the original instance and
slot overrides are directly copied. If the name of the new instance
created matches a currently existing instance-name, then the currently
existing instance is deleted without use of a message. The slot-override
expressions are passed as an EXTERNAL_ADDRESS data object to the
direct-duplicate handler. This message is used by the functions
<strong>duplicate-instance</strong> and <strong>active-duplicate-instance</strong>.</p>
<p>Example</p>
<p>The following around message-handler could be used to insure that all
duplicate message slot-overrides are handled using put- messages.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(defmessage-handler USER direct-duplicate around (?new-name ?overrides)
  (send ?self message-duplicate ?new-name ?overrides))
</pre></div>
</div>
</div>
<div class="section" id="duplicating-an-instance-using-messages">
<h4>9.4.4.7 Duplicating an Instance using Messages<a class="headerlink" href="#duplicating-an-instance-using-messages" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(defmessage-handler USER message-duplicate primary
  (?new-instance-name ?slot-override-expressions)
</pre></div>
</div>
<p>This handler duplicates an instance using messages. Slot values from the
original instance and slot overrides are copied using put- and get-
messages. If the name of the new instance created matches a currently
existing instance-name, then the currently existing instance is deleted
using a delete message. After creation, the new instance is sent a
create message and then an init message. The slot-override expressions
are passed as an EXTERNAL_ADDRESS data object to the message-duplicate
handler. This message is used by the functions
<strong>message-duplicate-instance</strong> and
<strong>active-message-duplicate-instance</strong>.</p>
</div>
<div class="section" id="instance-creation">
<h4>9.4.4.8 Instance Creation<a class="headerlink" href="#instance-creation" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">USER</span> <span class="n">create</span> <span class="n">primary</span> <span class="p">())</span>
</pre></div>
</div>
<p>This handler is called after an instance is created , but before any
slot initialization has occurred. The newly created instance is sent a
<strong>create</strong> message. This handler performs no actions?It is provided so
that instance creation can be detected by user-defined message-handlers.
The handler returns the symbol TRUE if the instance was successfully
created, otherwise it returns the symbol FALSE.</p>
</div>
</div>
</div>
<div class="section" id="message-dispatch">
<h2>9.5 Message Dispatch<a class="headerlink" href="#message-dispatch" title="Permalink to this headline">¶</a></h2>
<p>When a message is sent to an object using the <strong>send</strong> function, CLIPS
examines the class precedence list of the active instance?s class to
determine a complete set of message-handlers which are applicable to the
message. CLIPS uses the roles (around, before, primary or after) and
specificity of these message-handlers to establish an ordering and then
executes them. A handler that is attached to a subclass of another
message-handler?s class is said to be more specific. This entire process
is referred to as the <strong>message dispatch</strong>. Following is a flow diagram
summary:</p>
<p><a href="#id3"><span class="problematic" id="id4">|image3|</span></a></p>
<p>The solid arrows indicate automatic control transfer by the message
dispatch system. The dashed arrows indicate control transfer that can
only be accomplished by the use or lack of the use of
<strong>call-next-handler</strong> (or <strong>override-next-handler</strong>).</p>
<div class="section" id="applicability-of-message-handlers">
<h3>9.5.1 Applicability of Message-handlers<a class="headerlink" href="#applicability-of-message-handlers" title="Permalink to this headline">¶</a></h3>
<p>A message-handler is applicable to a message if its name matches the
message, and it is attached to a class which is in the class precedence
list of the class of the instance receiving the message.</p>
</div>
<div class="section" id="message-handler-precedence">
<h3>9.5.2 Message-handler Precedence<a class="headerlink" href="#message-handler-precedence" title="Permalink to this headline">¶</a></h3>
<p>The set of all applicable message-handlers are sorted into four groups
according to role, and these four groups are further sorted by class
specificity. The around, before and primary handlers are ordered from
most specific to most general, whereas after handlers are ordered from
most general to most specific.</p>
<p>The order of execution is as follows: 1) around handlers begin execution
from most specific to most general (each around handler must explicitly
allow execution of other handlers), 2) before handlers execute (one
after the other) from most specific to most general 3) primary handlers
begin execution from most specific to most general (more specific
primary handlers must explicitly allow execution of more general ones),
4) primary handlers finish execution from most general to most specific,
5) after handlers execute (one after the other) from most general to
most specific and 6) around handlers finish execution from most general
to most specific.</p>
<p>There must be at least one applicable primary handler for a message, or
a message execution error will be generated (see section 9.5.4).</p>
</div>
<div class="section" id="shadowed-message-handlers">
<h3>9.5.3 Shadowed Message-handlers<a class="headerlink" href="#shadowed-message-handlers" title="Permalink to this headline">¶</a></h3>
<p>When one handler must be called by another handler in order to be
executed, the first handler is said to be <strong>shadowed</strong> by the second. An
around handler shadows all handlers except more specific around
handlers. A primary handler shadows all more general primary handlers.</p>
<p>Messages should be implemented using the declarative technique, if
possible. Only the handler roles will dictate which handlers get
executed; only before and after handlers and the most specific primary
handler are used. This allows each handler for a message to be
completely independent of the other message-handlers. However, if around
handlers or shadowed primary handlers are necessary, then the handlers
must explicitly take part in the message dispatch by calling other
handlers they are shadowing. This is called the imperative technique.
The functions <strong>call-next-handler</strong> and <strong>override-next-handler</strong> (see
section 12.16.2) allow a handler to execute the handler it is shadowing.
A handler can call the same shadowed handler multiple times.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">USER</span> <span class="n">my</span><span class="o">-</span><span class="n">message</span> <span class="n">around</span> <span class="p">()</span>
  <span class="p">(</span><span class="n">call</span><span class="o">-</span><span class="nb">next</span><span class="o">-</span><span class="n">handler</span><span class="p">))</span>

<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">USER</span> <span class="n">my</span><span class="o">-</span><span class="n">message</span> <span class="n">before</span> <span class="p">())</span>

<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">USER</span> <span class="n">my</span><span class="o">-</span><span class="n">message</span> <span class="p">()</span>
  <span class="p">(</span><span class="n">call</span><span class="o">-</span><span class="nb">next</span><span class="o">-</span><span class="n">handler</span><span class="p">))</span>

<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">USER</span> <span class="n">my</span><span class="o">-</span><span class="n">message</span> <span class="n">after</span> <span class="p">())</span>

<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">OBJECT</span> <span class="n">my</span><span class="o">-</span><span class="n">message</span> <span class="n">around</span> <span class="p">()</span>
  <span class="p">(</span><span class="n">call</span><span class="o">-</span><span class="nb">next</span><span class="o">-</span><span class="n">handler</span><span class="p">))</span>

<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">OBJECT</span> <span class="n">my</span><span class="o">-</span><span class="n">message</span> <span class="n">before</span> <span class="p">())</span>

<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">OBJECT</span> <span class="n">my</span><span class="o">-</span><span class="n">message</span> <span class="p">())</span>

<span class="p">(</span><span class="n">defmessage</span><span class="o">-</span><span class="n">handler</span> <span class="n">OBJECT</span> <span class="n">my</span><span class="o">-</span><span class="n">message</span> <span class="n">after</span> <span class="p">())</span>
</pre></div>
</div>
<p>For a message sent to an instance of a class which inherits from USER,
the following diagram illustrates the order of execution for the
handlers attached to the classes USER and OBJECT. The brackets indicate
where a particular handler begins and ends execution. Handlers enclosed
within a bracket are shadowed.</p>
<p><a href="#id5"><span class="problematic" id="id6">|image4|</span></a></p>
</div>
<div class="section" id="message-execution-errors">
<h3>9.5.4 Message Execution Errors<a class="headerlink" href="#message-execution-errors" title="Permalink to this headline">¶</a></h3>
<p>If an error occurs at any time during the execution of a
message-handler, any currently executing handlers will be aborted, any
handlers which have not yet started execution will be ignored, and the
<strong>send</strong> function will return the symbol FALSE.</p>
<p>A lack of applicable of primary message-handlers and a handler being
called with the wrong number of arguments are common message execution
errors.</p>
</div>
<div class="section" id="message-return-value">
<h3>9.5.5 Message Return Value<a class="headerlink" href="#message-return-value" title="Permalink to this headline">¶</a></h3>
<p>The return value of call to the <strong>send</strong> function is the return value of
the most specific around handler, or the most specific primary handler
if there are no around handlers. The return value of a handler is the
result of the evaluation of the last action in the handler.</p>
<p>The return values of the before and after handlers are ignored; they are
for side-effects only. An around handler can choose to ignore or capture
the return value of the next most specific around or primary handler. A
primary handler can choose to ignore or capture the return value of a
more general primary handler.</p>
</div>
</div>
<div class="section" id="manipulating-instances">
<h2>9.6 Manipulating Instances<a class="headerlink" href="#manipulating-instances" title="Permalink to this headline">¶</a></h2>
<p>Objects are manipulated by sending them messages. This is achieved by
using the <strong>send</strong> function, which takes as arguments the destination
object for the message, the message itself and any arguments which are
to be passed to handlers.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">send</span> <span class="o">&lt;</span><span class="nb">object</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">message</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">expression</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>Section 2.4.2 explains object references. The return value of <strong>send</strong>
is the result of the message as explained in section 9.5.5.</p>
<p>The slots of an object may be read or set directly only within the body
of a message-handler that is executing on behalf of a message that was
sent to that object. This is how COOL implements the notion of
encapsulation (see Section 2.6.2). Any action performed on an object by
an external source, such as a rule or function, must be done with
messages. There are two major exceptions: 1) objects which are not
instances of user-defined classes (floating-point and integer numbers,
symbols, strings, multifield values, fact-addresses and
external-addresses) can be manipulated in the standard non-OOP manner of
previous versions of CLIPS as well and 2) creation and initialization of
an instance of a user-defined class are performed via the function
<strong>make-instance</strong>.</p>
<div class="section" id="creating-instances">
<h3>9.6.1 Creating Instances<a class="headerlink" href="#creating-instances" title="Permalink to this headline">¶</a></h3>
<p>Like facts, instances of user-defined classes must be explicitly created
by the user. Likewise, all instances are deleted during the <strong>reset</strong>
command, and they can be loaded and saved similarly to facts. All
operations involving instances require message-passing using the
<strong>send</strong> function except for creation, since the object does not yet
exist. A function called <strong>make-instance</strong> is used to create and
initialize a new instance. This function implicitly sends first a create
message and then an initialization message to the new object after
allocation. The user can customize instance initialization with daemons.
<strong>make-instance</strong> also allows slot-overrides to change any predefined
initialization for a particular instance. <strong>make-instance</strong>
automatically delays all object pattern-matching activities for rules
until all slot overrides have been processed. The function
<strong>active-make-instance</strong> can be used if delayed pattern-matching is not
desired. <strong>active-make-instance</strong> remembers the current state of delayed
pattern-matching, explicitly turns delay on, and then restores it to its
previous state once all slot overrides have been processed.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">definition</span><span class="o">&gt;</span><span class="p">)</span>
  <span class="p">(</span><span class="n">active</span><span class="o">-</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">definition</span><span class="o">&gt;</span><span class="p">)</span>

<span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">definition</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">of</span>
  <span class="o">&lt;</span><span class="n">class</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;*</span>

<span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">expression</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>The return value of <strong>make-instance</strong> is the name of the new instance on
success or the symbol FALSE on failure. The evaluation of
&lt;instance-name-expression&gt; can either be an instance-name or a symbol.
If &lt;instance-name-expression&gt; is not specified, then the function
<strong>gensym*</strong> will be called to generate the instance-name.</p>
<p>The <strong>make-instance</strong> function performs the following steps in order:</p>
<ol class="arabic simple">
<li>If an instance of the specified name already exists, that instance
receives a <strong>delete</strong> message, e.g. (send &lt;instance-name&gt; delete). If
this fails for any reason, the new instance creation is aborted.
Normally, the handler attached to class USER will respond to this
message (see section 9.4.5.2).</li>
<li>A new and uninitialized instance of the specified class is created
with the specified name.</li>
<li>The new instance receives the <strong>create</strong> message, e.g. (send
&lt;instance-name&gt; create). Normally, the handler attached to class USER
will respond to this message (see section 9.4.4.8), although it
performs no actions.</li>
<li>All slot-overrides are immediately evaluated and placed via <strong>put-</strong>
messages (see section 9.3.3.10), e.g. (send &lt;instance-name&gt;
put-&lt;slot-name&gt; &lt;expression&gt;*). If there are any errors, the new
instance is deleted.</li>
<li>The new instance receives the <strong>init</strong> message, e.g. (send
&lt;instance-name&gt; init). Normally, the handler attached to class USER will
respond to this message (see section 9.4.4.1). This handler calls the
<strong>init-slots</strong> function (see section 12.16.4.1). This function uses
defaults from the class definition (if any) for any slots which do not
have slot-overrides. The class defaults are placed directly without the
use of messages. If there are any errors, the new instance is deleted.</li>
</ol>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
  (slot x (default 34))
  (slot y (default abc)))
CLIPS&gt;
(defmessage-handler A put-x before (?value)
  (printout t &quot;Slot x set with message.&quot; crlf))
CLIPS&gt;
(defmessage-handler A delete after ()
  (printout t &quot;Old instance deleted.&quot; crlf))
CLIPS&gt; (make-instance a of A)
[a]
CLIPS&gt; (send [a] print)
[a] of A
(x 34)
(y abc)
CLIPS&gt; (make-instance [a] of A (x 65))
Old instance deleted.
Slot x set with message.
[a]
CLIPS&gt; (send [a] print)
a of A
(x 65)
(y abc)
CLIPS&gt; (send [a] delete)
Old instance deleted.
TRUE
CLIPS&gt;
</pre></div>
</div>
<div class="section" id="definstances-construct">
<h4>9.6.1.1 Definstances Construct<a class="headerlink" href="#definstances-construct" title="Permalink to this headline">¶</a></h4>
<p>Similar to deffacts, the <strong>definstances</strong> construct allows the
specification of instances which will be created every time the
<strong>reset</strong> command is executed. On every reset all current instances
receive a <strong>delete</strong> message, and the equivalent of a <strong>make-instance</strong>
function call is made for every instance specified in definstances
constructs.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">definstances</span> <span class="o">&lt;</span><span class="n">definstances</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">active</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">comment</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;*</span><span class="p">)</span>

<span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">definition</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>A definstances cannot use classes that have not been previously defined.
The instances of a definstances are created in order, and if any
individual creation fails, the remainder of the definstances will be
aborted. Normally, definstances just use the <strong>make-instance</strong> function
(which means delayed Rete activity) to create the instances. However, if
this is not desired, then the <em>active</em> keyword can be specified after
the definstances name so that the <strong>active-make-instance</strong> function will
be used.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">x</span> <span class="p">(</span><span class="n">default</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">definstances</span> <span class="n">A</span><span class="o">-</span><span class="n">OBJECTS</span>
  <span class="p">(</span><span class="n">a1</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
  <span class="p">(</span><span class="n">of</span> <span class="n">A</span> <span class="p">(</span><span class="n">x</span> <span class="mi">65</span><span class="p">)))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">watch</span> <span class="n">instances</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">reset</span><span class="p">)</span>
<span class="o">&lt;==</span> <span class="n">instance</span> <span class="p">[</span><span class="n">initial</span><span class="o">-</span><span class="nb">object</span><span class="p">]</span> <span class="n">of</span> <span class="n">INITIAL</span><span class="o">-</span><span class="n">OBJECT</span>
<span class="o">==&gt;</span> <span class="n">instance</span> <span class="p">[</span><span class="n">initial</span><span class="o">-</span><span class="nb">object</span><span class="p">]</span> <span class="n">of</span> <span class="n">INITIAL</span><span class="o">-</span><span class="n">OBJECT</span>
<span class="o">==&gt;</span> <span class="n">instance</span> <span class="p">[</span><span class="n">a1</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="o">==&gt;</span> <span class="n">instance</span> <span class="p">[</span><span class="n">gen1</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">reset</span><span class="p">)</span>
<span class="o">&lt;==</span> <span class="n">instance</span> <span class="p">[</span><span class="n">initial</span><span class="o">-</span><span class="nb">object</span><span class="p">]</span> <span class="n">of</span> <span class="n">INITIAL</span><span class="o">-</span><span class="n">OBJECT</span>
<span class="o">&lt;==</span> <span class="n">instance</span> <span class="p">[</span><span class="n">a1</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="o">&lt;==</span> <span class="n">instance</span> <span class="p">[</span><span class="n">gen1</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="o">==&gt;</span> <span class="n">instance</span> <span class="p">[</span><span class="n">initial</span><span class="o">-</span><span class="nb">object</span><span class="p">]</span> <span class="n">of</span> <span class="n">INITIAL</span><span class="o">-</span><span class="n">OBJECT</span>
<span class="o">==&gt;</span> <span class="n">instance</span> <span class="p">[</span><span class="n">a1</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="o">==&gt;</span> <span class="n">instance</span> <span class="p">[</span><span class="n">gen2</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">unwatch</span> <span class="n">instances</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Upon startup and after a <strong>clear</strong> command, CLIPS automatically
constructs the following definstances.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">definstances</span> <span class="n">initial</span><span class="o">-</span><span class="nb">object</span> <span class="p">(</span><span class="n">initial</span><span class="o">-</span><span class="nb">object</span> <span class="n">of</span> <span class="n">INITIAL</span><span class="o">-</span><span class="n">OBJECT</span><span class="p">))</span>
</pre></div>
</div>
<p>The class INITIAL-OBJECT is a predefined system class that is a direct
subclass of USER.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defclass</span> <span class="n">INITIAL</span><span class="o">-</span><span class="n">OBJECT</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">role</span> <span class="n">concrete</span><span class="p">)</span>
  <span class="p">(</span><span class="n">pattern</span><span class="o">-</span><span class="n">match</span> <span class="n">reactive</span><span class="p">))</span>
</pre></div>
</div>
<p>The initial-object definstances and the INITIAL-OBJECT class are only
defined if both the object system and defrules are enabled (see section
2 of the <em>Advanced Programming Guide</em>). The INITIAL-OBJECT class cannot
be deleted, but the <em>initial-object</em> definstances can. See section 5.4.9
for details on default patterns which pattern-match against the
<em>initial-object</em> instance.</p>
</div>
</div>
<div class="section" id="reinitializing-existing-instances">
<h3>9.6.2 Reinitializing Existing Instances<a class="headerlink" href="#reinitializing-existing-instances" title="Permalink to this headline">¶</a></h3>
<p>The <strong>initialize-instance</strong> function provides the ability to
reinitialize an existing instance with class defaults and new
slot-overrides. The return value of <strong>initialize-instance</strong> is the name
of the instance on success or the symbol FALSE on failure. The
evaluation of &lt;instance-name-expression&gt; can either be an instance-name,
instance-address or a symbol. <strong>initialize-instance</strong> automatically
delays all object pattern-matching activities for rules until all slot
overrides have been processed. The function
<strong>active-initialize-instance</strong> can be used if delayed pattern-matching
is not desired.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">initialize</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>The <strong>initialize-instance</strong> function performs the following steps in
order:</p>
<ol class="arabic simple">
<li>All slot-overrides are immediately evaluated and placed via <strong>put-</strong>
messages (see section 9.3.3.10), e.g. (send &lt;instance-name&gt;
put-&lt;slot-name&gt; &lt;expression&gt;*).</li>
<li>The instance receives the <strong>init</strong> message, e.g. (send
&lt;instance-name&gt; init). Normally, the handler attached to class USER will
respond to this message (see section 9.4.5.1). This handler calls the
<strong>init-slots</strong> function (see section 12.16.4.1). This function uses
defaults from the class definition (if any) for any slots that do not
have slot-overrides. The class defaults are placed directly without the
use of messages.</li>
</ol>
<p>If no slot-override or class default specifies the value of a slot, that
value will remain the same. Empty class default values allow
<strong>initialize-instance</strong> to clear a slot.</p>
<p>If an error occurs, the instance will <em>not</em> be deleted, but the slot
values may be in an inconsistent state.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
  (slot x (default 34))
  (slot y (default abc))
  (slot z))
CLIPS&gt; (make-instance a of A (y 100))
[a]
CLIPS&gt; (send [a] print)
[a] of A
(x 34)
(y 100)
(z nil)
CLIPS&gt; (send [a] put-x 65)
65
CLIPS&gt; (send [a] put-y abc)
abc
CLIPS&gt; (send [a] put-z &quot;Hello world.&quot;)
?Hello world.?
CLIPS&gt; (send [a] print)
[a] of A
(x 65)
(y abc)
(z &quot;Hello world.&quot;)
CLIPS&gt; (initialize-instance a)
[a]
CLIPS&gt; (send [a] print)
a of A
(x 34)
(y abc)
(z nil)
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="reading-slots">
<h3>9.6.3 Reading Slots<a class="headerlink" href="#reading-slots" title="Permalink to this headline">¶</a></h3>
<p>Sources external to an object, such as a rule or deffunction, can read
an object?s slots only by sending the object a message. Message-handlers
executing on the behalf of an object can either use messages or direct
access to read the object?s slots (see section 9.4.2). Several functions
also exist which operate implicitly on the active instance for a message
that can only be called by message-handlers, such as <strong>dynamic-get</strong>
(see section 12.16.4.10).</p>
<p>Section 12.16 describes ways of testing for the existence of slots and
their values.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
<span class="p">(</span><span class="n">slot</span> <span class="n">x</span> <span class="p">(</span><span class="n">default</span> <span class="n">abc</span><span class="p">)))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">sym</span><span class="o">-</span><span class="n">cat</span> <span class="p">(</span><span class="n">send</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">get</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="n">def</span><span class="p">)</span>
<span class="n">abcdef</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-slots">
<h3>9.6.4 Setting Slots<a class="headerlink" href="#setting-slots" title="Permalink to this headline">¶</a></h3>
<p>Sources external to an object, such as a rule or deffunction, can write
an object?s slots only by sending the object a message. Several
functions also exist which operate implicitly on the active instance for
a message that can only be called by message-handlers, such as
<strong>dynamic-put</strong> (see section 12.16.4.11). The <strong>bind</strong> function can also
be used to set a slot’s value from within a message-handler (see section
9.4.2).</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (clear)
CLIPS&gt;
(defclass A (is-a USER)
(slot x (default abc)))
CLIPS&gt; (make-instance a of A)
[a]
CLIPS&gt; (send [a] put-x &quot;New value.&quot;)
?New value.?
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="deleting-instances">
<h3>9.6.5 Deleting Instances<a class="headerlink" href="#deleting-instances" title="Permalink to this headline">¶</a></h3>
<p>Sending the <strong>delete</strong> message to an instance removes it from the
system. Within a message-handler, the <strong>delete-instance</strong> function (see
section 12.16) can be used to delete the active instance for a message.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">send</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">&gt;</span> <span class="n">delete</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="delayed-pattern-matching-when-manipulating-instances">
<h3>9.6.6 Delayed Pattern-Matching When Manipulating Instances<a class="headerlink" href="#delayed-pattern-matching-when-manipulating-instances" title="Permalink to this headline">¶</a></h3>
<p>While manipulating instances (either by creating, modifying, or
deleting), it is possible to delay pattern-matching activities for rules
until after all of the manipulations have been made. This can be
accomplished using the <strong>object-pattern-match-delay</strong> function. This
function acts identically to the <strong>progn</strong> function, however, any
actions that could affect object pattern-matching for rules are delayed
until the function is exited. This function?s primary purpose is to
provide some control over performance.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">object</span><span class="o">-</span><span class="n">pattern</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">delay</span> <span class="o">&lt;</span><span class="n">action</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defrule</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span>
  <span class="p">(</span><span class="nb">object</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">A</span><span class="p">))</span>
  <span class="o">=&gt;</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">agenda</span><span class="p">)</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">For</span> <span class="n">a</span> <span class="n">total</span> <span class="n">of</span> <span class="mi">1</span> <span class="n">activation</span><span class="o">.</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">b</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">b</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">agenda</span><span class="p">)</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">For</span> <span class="n">a</span> <span class="n">total</span> <span class="n">of</span> <span class="mi">2</span> <span class="n">activations</span><span class="o">.</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="nb">object</span><span class="o">-</span><span class="n">pattern</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">delay</span>
  <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">c</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
  <span class="p">(</span><span class="n">printout</span> <span class="n">t</span> <span class="s2">&quot;After c...&quot;</span> <span class="n">crlf</span><span class="p">)</span>
  <span class="p">(</span><span class="n">agenda</span><span class="p">)</span>
  <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">d</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
  <span class="p">(</span><span class="n">printout</span> <span class="n">t</span> <span class="s2">&quot;After d...&quot;</span> <span class="n">crlf</span><span class="p">)</span>
  <span class="p">(</span><span class="n">agenda</span><span class="p">))</span>
<span class="n">After</span> <span class="n">c</span><span class="o">...</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">For</span> <span class="n">a</span> <span class="n">total</span> <span class="n">of</span> <span class="mi">2</span> <span class="n">activations</span><span class="o">.</span>
<span class="n">After</span> <span class="n">d</span><span class="o">...</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">For</span> <span class="n">a</span> <span class="n">total</span> <span class="n">of</span> <span class="mi">2</span> <span class="n">activations</span><span class="o">.</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">agenda</span><span class="p">)</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span>
<span class="mi">0</span> <span class="n">match</span><span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">For</span> <span class="n">a</span> <span class="n">total</span> <span class="n">of</span> <span class="mi">4</span> <span class="n">activations</span><span class="o">.</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-instances">
<h3>9.6.7 Modifying Instances<a class="headerlink" href="#modifying-instances" title="Permalink to this headline">¶</a></h3>
<p>Four functions are provided for modifying instances. These functions
allow instance slot updates to be performed in blocks without requiring
a series of put- messages. Each of these functions returns the symbol
TRUE if successful, otherwise the symbol FALSE is returned.</p>
<div class="section" id="directly-modifying-an-instance-with-delayed-pattern-matching">
<h4>9.6.7.1 Directly Modifying an Instance with Delayed Pattern-Matching<a class="headerlink" href="#directly-modifying-an-instance-with-delayed-pattern-matching" title="Permalink to this headline">¶</a></h4>
<p>The <strong>modify-instance</strong> function uses the <strong>direct-modify</strong> message to
change the values of the instance. Object pattern-matching is delayed
until all of the slot modifications have been performed.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">modify</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">foo</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">bar</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">watch</span> <span class="nb">all</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">modify</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="p">(</span><span class="n">foo</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">direct</span><span class="o">-</span><span class="n">modify</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">0019</span><span class="n">CD5A</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">direct</span><span class="o">-</span><span class="n">modify</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span><span class="o">.</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">0019</span><span class="n">CD5A</span><span class="o">&gt;</span><span class="p">)</span>
<span class="p">::</span><span class="o">=</span> <span class="n">local</span> <span class="n">slot</span> <span class="n">foo</span> <span class="ow">in</span> <span class="n">instance</span> <span class="n">a</span> <span class="o">&lt;-</span> <span class="mi">0</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">direct</span><span class="o">-</span><span class="n">modify</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span><span class="o">.</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">0019</span><span class="n">CD5A</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">direct</span><span class="o">-</span><span class="n">modify</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">0019</span><span class="n">CD5A</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">TRUE</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">unwatch</span> <span class="nb">all</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="directly-modifying-an-instance-with-immediate-pattern-matching">
<h4>9.6.7.2 Directly Modifying an Instance with Immediate Pattern-Matching<a class="headerlink" href="#directly-modifying-an-instance-with-immediate-pattern-matching" title="Permalink to this headline">¶</a></h4>
<p>The <strong>active-modify-instance</strong> function uses the <strong>direct-modify</strong>
message to change the values of the instance. Object pattern-matching
occurs as slot modifications are being performed.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">active</span><span class="o">-</span><span class="n">modify</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-an-instance-using-messages-with-delayed-pattern-matching">
<h4>9.6.7.3 Modifying an Instance using Messages with Delayed Pattern-Matching<a class="headerlink" href="#modifying-an-instance-using-messages-with-delayed-pattern-matching" title="Permalink to this headline">¶</a></h4>
<p>The <strong>message-modify-instance</strong> function uses the <strong>message-modify</strong>
message to change the values of the instance. Object pattern-matching is
delayed until all of the slot modifications have been performed.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">message</span><span class="o">-</span><span class="n">modify</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">foo</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">bar</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">watch</span> <span class="nb">all</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">message</span><span class="o">-</span><span class="n">modify</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="p">(</span><span class="n">bar</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">message</span><span class="o">-</span><span class="n">modify</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">009</span><span class="n">F04A0</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">message</span><span class="o">-</span><span class="n">modify</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">009</span><span class="n">F04A0</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">put</span><span class="o">-</span><span class="n">bar</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">put</span><span class="o">-</span><span class="n">bar</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">::</span><span class="o">=</span> <span class="n">local</span> <span class="n">slot</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">instance</span> <span class="n">a</span> <span class="o">&lt;-</span> <span class="mi">4</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">put</span><span class="o">-</span><span class="n">bar</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">put</span><span class="o">-</span><span class="n">bar</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">message</span><span class="o">-</span><span class="n">modify</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">009</span><span class="n">F04A0</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">message</span><span class="o">-</span><span class="n">modify</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">009</span><span class="n">F04A0</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">TRUE</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">unwatch</span> <span class="nb">all</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-an-instance-using-messages-with-immediate-pattern-matching">
<h4>9.6.7.4 Modifying an Instance using Messages with Immediate Pattern-Matching<a class="headerlink" href="#modifying-an-instance-using-messages-with-immediate-pattern-matching" title="Permalink to this headline">¶</a></h4>
<p>The <strong>active-message-modify-instance</strong> function uses the
<strong>message-modify</strong> message to change the values of the instance. Object
pattern-matching occurs as slot modifications are being performed.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">active</span><span class="o">-</span><span class="n">message</span><span class="o">-</span><span class="n">modify</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="duplicating-instances">
<h3>9.6.8 Duplicating Instances<a class="headerlink" href="#duplicating-instances" title="Permalink to this headline">¶</a></h3>
<p>Four functions are provided for duplicating instances. These functions
allow instance duplication and slot updates to be performed in blocks
without requiring a series of put- messages. Each of these functions
return the instance-name of the new duplicated instance if successful,
otherwise the symbol FALSE is returned.</p>
<p>Each of the duplicate functions can optionally specify the name of the
instance to which the old instance will be copied. If the name is not
specified, the function will generate the name using the (gensym*)
function. If the target instance already exists, it will be deleted
directly or with a delete message depending on which function was
called.</p>
<div class="section" id="directly-duplicating-an-instance-with-delayed-pattern-matching">
<h4>9.6.8.1 Directly Duplicating an Instance with Delayed Pattern-Matching<a class="headerlink" href="#directly-duplicating-an-instance-with-delayed-pattern-matching" title="Permalink to this headline">¶</a></h4>
<p>The <strong>duplicate-instance</strong> function uses the <strong>direct-duplicate</strong>
message to change the values of the instance. Object pattern-matching is
delayed until all of the slot modifications have been performed.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">duplicate</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">to</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">setgen</span> <span class="mi">1</span><span class="p">)</span>
<span class="mi">1</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">foo</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">bar</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span> <span class="p">(</span><span class="n">foo</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="n">bar</span> <span class="mi">4</span><span class="p">))</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">watch</span> <span class="nb">all</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">duplicate</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">direct</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">gen1</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">00000000</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">direct</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">gen1</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">00000000</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">==&gt;</span> <span class="n">instance</span> <span class="p">[</span><span class="n">gen1</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="p">::</span><span class="o">=</span> <span class="n">local</span> <span class="n">slot</span> <span class="n">foo</span> <span class="ow">in</span> <span class="n">instance</span> <span class="n">gen1</span> <span class="o">&lt;-</span> <span class="mi">0</span>
<span class="p">::</span><span class="o">=</span> <span class="n">local</span> <span class="n">slot</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">instance</span> <span class="n">gen1</span> <span class="o">&lt;-</span> <span class="mi">4</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">direct</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">gen1</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">00000000</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">direct</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">gen1</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">00000000</span><span class="o">&gt;</span><span class="p">)</span>
<span class="p">[</span><span class="n">gen1</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">unwatch</span> <span class="nb">all</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="directly-duplicating-an-instance-with-immediate-pattern-matching">
<h4>9.6.8.2 Directly Duplicating an Instance with Immediate Pattern-Matching<a class="headerlink" href="#directly-duplicating-an-instance-with-immediate-pattern-matching" title="Permalink to this headline">¶</a></h4>
<p>The <strong>active-duplicate-instance</strong> function uses the <strong>direct-duplicate</strong>
message to change the values of the instance. Object pattern-matching
occurs as slot modifications are being performed.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">active</span><span class="o">-</span><span class="n">duplicate</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">to</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="duplicating-an-instance-using-messages-with-delayed-pattern-matching">
<h4>9.6.8.3 Duplicating an Instance using Messages with Delayed Pattern-Matching<a class="headerlink" href="#duplicating-an-instance-using-messages-with-delayed-pattern-matching" title="Permalink to this headline">¶</a></h4>
<p>The <strong>message-duplicate-instance</strong> function uses the
<strong>message-duplicate</strong> message to change the values of the instance.
Object pattern-matching is delayed until all of the slot modifications
have been performed.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">message</span><span class="o">-</span><span class="n">duplicate</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">to</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">defclass</span> <span class="n">A</span> <span class="p">(</span><span class="ow">is</span><span class="o">-</span><span class="n">a</span> <span class="n">USER</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">foo</span><span class="p">)</span>
  <span class="p">(</span><span class="n">slot</span> <span class="n">bar</span><span class="p">))</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">of</span> <span class="n">A</span> <span class="p">(</span><span class="n">foo</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="n">bar</span> <span class="mi">4</span><span class="p">))</span>
<span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">instance</span> <span class="n">b</span> <span class="n">of</span> <span class="n">A</span><span class="p">)</span>
<span class="p">[</span><span class="n">b</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">watch</span> <span class="nb">all</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">message</span><span class="o">-</span><span class="n">duplicate</span><span class="o">-</span><span class="n">instance</span> <span class="n">a</span> <span class="n">to</span> <span class="n">b</span> <span class="p">(</span><span class="n">bar</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">message</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">009</span><span class="n">F04A0</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">message</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">009</span><span class="n">F04A0</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">delete</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">delete</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">&lt;==</span> <span class="n">instance</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">delete</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Stale</span> <span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">delete</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Stale</span> <span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">==&gt;</span> <span class="n">instance</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="n">of</span> <span class="n">A</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">create</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">create</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">create</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">create</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">put</span><span class="o">-</span><span class="n">bar</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">put</span><span class="o">-</span><span class="n">bar</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span> <span class="mi">6</span><span class="p">)</span>
<span class="p">::</span><span class="o">=</span> <span class="n">local</span> <span class="n">slot</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">instance</span> <span class="n">b</span> <span class="o">&lt;-</span> <span class="mi">6</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">put</span><span class="o">-</span><span class="n">bar</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">put</span><span class="o">-</span><span class="n">bar</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">put</span><span class="o">-</span><span class="n">foo</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">put</span><span class="o">-</span><span class="n">foo</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">::</span><span class="o">=</span> <span class="n">local</span> <span class="n">slot</span> <span class="n">foo</span> <span class="ow">in</span> <span class="n">instance</span> <span class="n">b</span> <span class="o">&lt;-</span> <span class="mi">0</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">put</span><span class="o">-</span><span class="n">foo</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">A</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">put</span><span class="o">-</span><span class="n">foo</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&gt;&gt;</span> <span class="n">init</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&gt;&gt;</span> <span class="n">init</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">init</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">init</span> <span class="n">ED</span><span class="p">:</span><span class="mi">2</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">b</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">HND</span> <span class="o">&lt;&lt;</span> <span class="n">message</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">primary</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">USER</span>
<span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">009</span><span class="n">F04A0</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">MSG</span> <span class="o">&lt;&lt;</span> <span class="n">message</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">ED</span><span class="p">:</span><span class="mi">1</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">-</span><span class="n">a</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">Pointer</span><span class="o">-</span><span class="mi">009</span><span class="n">F04A0</span><span class="o">&gt;</span><span class="p">)</span>
<span class="p">[</span><span class="n">b</span><span class="p">]</span>
<span class="n">CLIPS</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">unwatch</span> <span class="nb">all</span><span class="p">)</span>
<span class="n">CLIPS</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="duplicating-an-instance-using-messages-with-immediate-pattern-matching">
<h4>9.6.8.4 Duplicating an Instance using Messages with Immediate Pattern-Matching<a class="headerlink" href="#duplicating-an-instance-using-messages-with-immediate-pattern-matching" title="Permalink to this headline">¶</a></h4>
<p>The <strong>active-message-duplicate-instance</strong> function uses the
<strong>message-duplicate</strong> message to change the values of the instance.
Object pattern-matching occurs as slot modifications are being
performed.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">active</span><span class="o">-</span><span class="n">message</span><span class="o">-</span><span class="n">duplicate</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">to</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">]</span>
   <span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">override</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="instance-set-queries-and-distributed-actions">
<span id="instanceset-queries-and-distributed-actions-1"></span><h2>9.7 Instance-set Queries and Distributed Actions<a class="headerlink" href="#instance-set-queries-and-distributed-actions" title="Permalink to this headline">¶</a></h2>
<p>COOL provides a useful query system for determining and performing
actions on sets of instances of user-defined classes that satisfy
user-defined queries. The instance query system in COOL provides six
functions, each of which operate on instance-sets determined by
user-defined criteria:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Function</strong></th>
<th class="head"><strong>Purpose</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>any-instancep</td>
<td>Determines if one or more instance-sets satisfy a query</td>
</tr>
<tr class="row-odd"><td>find-instance</td>
<td>Returns the first instance-set that satisfies a query</td>
</tr>
<tr class="row-even"><td>find-all-instances</td>
<td>Groups and returns all instance-sets which satisfy a query</td>
</tr>
<tr class="row-odd"><td>do-for-instance</td>
<td>Performs an action for the first instance-set which satisfies a query</td>
</tr>
<tr class="row-even"><td>do-for-all-instances</td>
<td>Performs an action for every instance-set which satisfies a query as they are found</td>
</tr>
<tr class="row-odd"><td>delayed-do-for-all-instances</td>
<td>Groups all instance-sets which satisfy a query and then iterates an action over this group</td>
</tr>
</tbody>
</table>
<p>Explanations on how to form instance-set templates, queries and actions
immediately follow, for these definitions are common to all of the query
functions. The specific details of each query function will then be
given. The following is a complete example of an instance-set query
function:</p>
<p>Example</p>
<p><a href="#id7"><span class="problematic" id="id8">|image5|</span></a></p>
<p>For all of the examples in this section, assume that the commands below
have already been entered:</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt;
(defclass PERSON (is-a USER)
  (role abstract)
  (slot sex (access read-only)
  (storage shared))
  (slot age (type NUMBER)
  (create-accessor ?NONE)
  (visibility public)))
CLIPS&gt;
(defmessage-handler PERSON put-age (?value)
  (dynamic-put age ?value))
CLIPS&gt;
(defclass FEMALE (is-a PERSON)
  (role abstract)
  (slot sex (source composite)
  (default female)))
CLIPS&gt;
(defclass MALE (is-a PERSON)
  (role abstract)
  (slot sex (source composite)
  (default male)))
CLIPS&gt;
(defclass GIRL (is-a FEMALE)
  (role concrete)
  (slot age (source composite)
  (default 4)
  (range 0.0 17.9)))
CLIPS&gt;
(defclass WOMAN (is-a FEMALE)
  (role concrete)
  (slot age (source composite)
  (default 25)
  (range 18.0 100.0)))
CLIPS&gt;
(defclass BOY (is-a MALE)
  (role concrete)
  (slot age (source composite)
  (default 4)
  (range 0.0 17.9)))
CLIPS&gt;
(defclass MAN (is-a MALE)
  (role concrete)
  (slot age (source composite)
  (default 25)
  (range 18.0 100.0)))
CLIPS&gt;
(definstances PEOPLE
  (Man-1 of MAN (age 18))
  (Man-2 of MAN (age 60))
  (Woman-1 of WOMAN (age 18))
  (Woman-2 of WOMAN (age 60))
  (Woman-3 of WOMAN)
  (Boy-1 of BOY (age 8))
  (Boy-2 of BOY)
  (Boy-3 of BOY)
  (Boy-4 of BOY)
  (Girl-1 of GIRL (age 8))
  (Girl-2 of GIRL))
CLIPS&gt; (reset)
CLIPS&gt;
</pre></div>
</div>
<div class="section" id="instance-set-definition">
<h3>9.7.1 Instance-set Definition<a class="headerlink" href="#instance-set-definition" title="Permalink to this headline">¶</a></h3>
<p>An <strong>instance-set</strong> is an ordered collection of instances. Each
<strong>instance-set member</strong> is an instance of a set of classes, called
<strong>class restrictions</strong>, defined by the user. The class restrictions can
be different for each instance-set member. The query functions use
<strong>instance-set templates</strong> to generate instance-sets. An instance-set
template is a set of <strong>instance-set member variables</strong> and their
associated class restrictions. Instance-set member variables reference
the corresponding members in each instance-set that matches a template.
Variables may be used to specify the classes for the instance-set
template, but if the constant names of the classes are specified, the
classes must already be defined. Module specifiers may be included with
the class names; the classes need not be in scope of the current module.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">member</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;+</span><span class="p">)</span>

<span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">member</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">member</span><span class="o">-</span><span class="n">variable</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">class</span><span class="o">-</span><span class="n">restrictions</span><span class="o">&gt;</span><span class="p">)</span>

<span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">member</span><span class="o">-</span><span class="n">variable</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="o">&lt;</span><span class="n">single</span><span class="o">-</span><span class="n">field</span><span class="o">-</span><span class="n">variable</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">class</span><span class="o">-</span><span class="n">restrictions</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="o">&lt;</span><span class="n">class</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;+</span>
</pre></div>
</div>
<p>Example</p>
<p>One instance-set template might be the ordered pairs of boys or men and
girls or women.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>((?man-or-boy BOY MAN) (?woman-or-girl GIRL WOMAN))
</pre></div>
</div>
<p>This instance-set template could have been written equivalently:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>((?man-or-boy MALE) (?woman-or-girl FEMALE))
</pre></div>
</div>
<p>Instance-set member variables (e.g. ?man-or-boy) are bound to
instance-names.</p>
</div>
<div class="section" id="instance-set-determination">
<h3>9.7.2 Instance-set Determination<a class="headerlink" href="#instance-set-determination" title="Permalink to this headline">¶</a></h3>
<p>COOL uses straightforward permutations to generate instance-sets that
match an instance-set template from the actual instances in the system.
The rules are as follows:</p>
<ol class="arabic simple">
<li>When there is more than one member in an instance-set template, vary
the rightmost members first.</li>
<li>When there is more than one class that an instance-set member can be,
iterate through the classes from left to right.</li>
<li>Examine instances of a class in the order that they were defined.</li>
<li>Recursively examine instances of subclasses in the order that the
subclasses were defined. If the specified query class was in scope of
the current module, then only subclasses that are also in scope will be
examined. Otherwise, only subclasses that are in scope of the module to
which the query class belongs will be examined.</li>
</ol>
<p>Example</p>
<p>For the instance-set template given in section 9.7.1, thirty
instance-sets would be generated in the following order:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=====================</span> <span class="o">=====================</span>
<span class="mf">1.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="mf">16.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="mf">2.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>   <span class="mf">17.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mf">3.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="mf">18.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="mf">4.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="mf">19.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mf">5.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>  <span class="mf">20.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="mf">6.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="mf">21.</span> <span class="p">[</span><span class="n">Man</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="mf">7.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>   <span class="mf">22.</span> <span class="p">[</span><span class="n">Man</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mf">8.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="mf">23.</span> <span class="p">[</span><span class="n">Man</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="mf">9.</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="mf">24.</span> <span class="p">[</span><span class="n">Man</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mf">10.</span><span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>  <span class="mf">25.</span> <span class="p">[</span><span class="n">Man</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="mf">11.</span><span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="mf">26.</span> <span class="p">[</span><span class="n">Man</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="mf">12.</span><span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>   <span class="mf">27.</span> <span class="p">[</span><span class="n">Man</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mi">13</span> <span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="mf">28.</span> <span class="p">[</span><span class="n">Man</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="mf">14.</span><span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="mf">29.</span> <span class="p">[</span><span class="n">Man</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mf">15.</span><span class="p">[</span><span class="n">Boy</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>  <span class="mf">30.</span> <span class="p">[</span><span class="n">Man</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="o">=====================</span> <span class="o">=====================</span>
</pre></div>
</div>
<p>Example</p>
<p>Consider the following instance-set template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>((?f1 FEMALE) (?f2 FEMALE))
</pre></div>
</div>
<p>Twenty-five instance-sets would be generated in the following order:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">======================</span> <span class="o">======================</span>
<span class="mf">1.</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="mf">14.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mf">2.</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>   <span class="mf">15.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="mf">3.</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="mf">16.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="mf">4.</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="mf">17.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mf">5.</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>  <span class="mf">18.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="mf">6.</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="mf">19.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mf">7.</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>   <span class="mf">20.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="mf">8.</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="mf">21.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="mf">9.</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="mf">22.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mf">10.</span><span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>  <span class="mf">23.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="mf">11.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="mf">24.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="mf">12.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Girl</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="mf">25.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="mf">13.</span><span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Woman</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="o">======================</span> <span class="o">======================</span>
</pre></div>
</div>
<p>The instances of class GIRL are examined before the instances of class
WOMAN because GIRL was defined before WOMAN.</p>
</div>
<div class="section" id="query-definition">
<h3>9.7.3 Query Definition<a class="headerlink" href="#query-definition" title="Permalink to this headline">¶</a></h3>
<p>A <strong>query</strong> is a user-defined boolean expression applied to an
instance-set to determine if the instance-set meets further user-defined
restrictions. If the evaluation of this expression for an instance-set
is anything but the symbol FALSE, the instance-set is said to satisfy
the query.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="o">&lt;</span><span class="n">boolean</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example</p>
<p>Continuing the previous example, one query might be that the two
instances in an ordered pair have the same age.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(= (send ?man-or-boy get-age) (send ?woman-or-girl get-age))
</pre></div>
</div>
<p>Within a query, slots of instance-set members can be directly read with
a shorthand notation similar to that used in message-handlers (see
section 9.4.2). If message-passing is not explicitly required for
reading a slot (i.e. there are no accessor daemons for reads), then this
second method of slot access should be used, for it gives a significant
performance benefit.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">member</span><span class="o">-</span><span class="n">variable</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">slot</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example</p>
<p>The previous example could be rewritten as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(= ?man-or-boy:age ?woman-or-girl:age)
</pre></div>
</div>
<p>Since only instance-sets that satisfy a query are of interest, and the
query is evaluated for all possible instance-sets, the query should not
have any side-effects.</p>
</div>
<div class="section" id="distributed-action-definition">
<h3>9.7.4 Distributed Action Definition<a class="headerlink" href="#distributed-action-definition" title="Permalink to this headline">¶</a></h3>
<p>A <strong>distributed action</strong> is a user-defined expression evaluated for each
instance-set which satisfies a query. Unlike queries, distributed
actions must use messages to read slots of instance-set members. If more
than one action is required, use the <strong>progn</strong> function (see section
12.6.5) to group them.</p>
<p>Action <code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">action</span><span class="o">&gt;</span> <span class="p">::</span><span class="o">=</span> <span class="o">&lt;</span><span class="n">expression</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example</p>
<p>Continuing the previous example, one distributed action might be to
simply print out the ordered pair to the screen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(printout t &quot;(&quot; ?man-or-boy &quot;,&quot; ?woman-or-girl &quot;)&quot; crlf)
</pre></div>
</div>
</div>
<div class="section" id="scope-in-instance-set-query-functions">
<h3>9.7.5 Scope in Instance-set Query Functions<a class="headerlink" href="#scope-in-instance-set-query-functions" title="Permalink to this headline">¶</a></h3>
<p>An instance-set query function can be called from anywhere that a
regular function can be called. If a variable from an outer scope is not
masked by an instance-set member variable, then that variable may be
referenced within the query and action. In addition, rebinding variables
within an instance-set function action is allowed. However, attempts to
rebind instance-set member variables will generate errors. Binding
variables is not allowed within a query. Instance-set query functions
can be nested.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt;
(deffunction count-instances (?class)
  (bind ?count 0)
  (do-for-all-instances ((?ins ?class)) TRUE
  (bind ?count (+ ?count 1)))
  ?count)
CLIPS&gt;
(deffunction count-instances-2 (?class)
  (length (find-all-instances ((?ins ?class)) TRUE)))
CLIPS&gt; (count-instances WOMAN)
3
CLIPS&gt; (count-instances-2 BOY)
4
CLIPS&gt;
</pre></div>
</div>
<p>Instance-set member variables are only in scope within the instance-set
query function. Attempting to use instance-set member variables in an
outer scope will generate an error.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt;
    (deffunction last-instance (?class)
      (any-instancep ((?ins ?class)) TRUE)
      ?ins)
    [PRCCODE3] Undefined variable ins referenced in deffunction.
    ERROR:
    (deffunction MAIN::last-instance
      (?class)
      (any-instancep ((?ins ?class))
      TRUE)
      ?ins)
    CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="errors-during-instance-set-query-functions">
<h3>9.7.6 Errors during Instance-set Query Functions<a class="headerlink" href="#errors-during-instance-set-query-functions" title="Permalink to this headline">¶</a></h3>
<p>If an error occurs during an instance-set query function, the function
will be immediately terminated and the return value will be the symbol
FALSE.</p>
</div>
<div class="section" id="halting-and-returning-values-from-query-functions">
<h3>9.7.7 Halting and Returning Values from Query Functions<a class="headerlink" href="#halting-and-returning-values-from-query-functions" title="Permalink to this headline">¶</a></h3>
<p>The functions <strong>break</strong> and <strong>return</strong> are now valid inside the action
of the instance-set query functions <strong>do-for-instance</strong>,
<strong>do-for-all-instances</strong> and <strong>delayed-do-for-all-instances</strong>. The
<strong>return</strong> function is only valid if it is applicable in the outer
scope, whereas the <strong>break</strong> function actually halts the query.</p>
</div>
<div class="section" id="instance-set-query-functions">
<h3>9.7.8 Instance-set Query Functions<a class="headerlink" href="#instance-set-query-functions" title="Permalink to this headline">¶</a></h3>
<p>The instance query system in COOL provides six functions. For a given
set of instances, all six query functions will iterate over these
instances in the same order (see section 9.7.2). However, if a
particular instance is deleted and recreated, the iteration order will
change.</p>
<div class="section" id="testing-if-any-instance-set-satisfies-a-query">
<h4>9.7.8.1 Testing if Any Instance-set Satisfies a Query<a class="headerlink" href="#testing-if-any-instance-set-satisfies-a-query" title="Permalink to this headline">¶</a></h4>
<p>This function applies a query to each instance-set that matches the
template. If an instance-set satisfies the query, then the function is
immediately terminated, and the return value is the symbol TRUE.
Otherwise, the return value is the symbol FALSE.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">any</span><span class="o">-</span><span class="n">instancep</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<p>Are there any men over age 30?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (any-instancep ((?man MAN)) (&gt; ?man:age 30))
TRUE
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="determining-the-first-instance-set-satisfying-a-query">
<h4>9.7.8.2 Determining the First Instance-set Satisfying a Query<a class="headerlink" href="#determining-the-first-instance-set-satisfying-a-query" title="Permalink to this headline">¶</a></h4>
<p>This function applies a query to each instance-set that matches the
template. If an instance-set satisfies the query, then the function is
immediately terminated, and the instance-set is returned in a multifield
value. Otherwise, the return value is a zero-length multifield value.
Each field of the multifield value is an instance-name representing an
instance-set member.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">find</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<p>Find the first pair of a man and a woman who have the same age.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt;
(find-instance ((?m MAN) (?w WOMAN)) (= ?m:age ?w:age))

([Man-1] [Woman-1])
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="determining-all-instance-sets-satisfying-a-query">
<h4>9.7.8.3 Determining All Instance-sets Satisfying a Query<a class="headerlink" href="#determining-all-instance-sets-satisfying-a-query" title="Permalink to this headline">¶</a></h4>
<p>This function applies a query to each instance-set that matches the
template. Each instance-set that satisfies the query is stored in a
multifield value. This multifield value is returned when the query has
been applied to all possible instance-sets. If there are n instances in
each instance-set, and m instance-sets satisfied the query, then the
length of the returned multifield value will be n * m. The first n
fields correspond to the first instance-set, and so on. Each field of
the multifield value is an instance-name representing an instance-set
member. The multifield value can consume a large amount of memory due to
permutational explosion, so this function should be used judiciously.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">find</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">instances</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<p>Find all pairs of a man and a woman who have the same age.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt;
(find-all-instances ((?m MAN) (?w WOMAN)) (= ?m:age ?w:age))

([Man-1] [Woman-1] [Man-2] [Woman-2])
CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="executing-an-action-for-the-first-instance-set-satisfying-a-query">
<h4>9.7.8.4 Executing an Action for the First Instance-set Satisfying a Query<a class="headerlink" href="#executing-an-action-for-the-first-instance-set-satisfying-a-query" title="Permalink to this headline">¶</a></h4>
<p>This function applies a query to each instance-set that matches the
template. If an instance-set satisfies the query, the specified action
is executed, and the function is immediately terminated. The return
value is the evaluation of the action. If no instance-set satisfied the
query, then the return value is the symbol FALSE.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">do</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">instance</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">action</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<p>Print out the first triplet of different people that have the same age.
The calls to <strong>neq</strong> in the query eliminate the permutations where two
or more members of the instance-set are identical.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt;
(do-for-instance ((?p1 PERSON) (?p2 PERSON) (?p3 PERSON))
  (and (= ?p1:age ?p2:age ?p3:age)
  (neq ?p1 ?p2)
  (neq ?p1 ?p3)
  (neq ?p2 ?p3))
  (printout t ?p1 &quot; &quot; ?p2 &quot; &quot; ?p3 crlf))

  [Girl-2] [Boy-2] [Boy-3]
  CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="executing-an-action-for-all-instance-sets-satisfying-a-query">
<h4>9.7.8.5 Executing an Action for All Instance-sets Satisfying a Query<a class="headerlink" href="#executing-an-action-for-all-instance-sets-satisfying-a-query" title="Permalink to this headline">¶</a></h4>
<p>This function applies a query to each instance-set that matches the
template. If an instance-set satisfies the query, the specified action
is executed. The return value is the evaluation of the action for the
last instance-set that satisfied the query. If no instance-set satisfied
the query, then the return value is the symbol FALSE.</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">do</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">instances</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">action</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<p>Print out all triplets of different people that have the same age. The
calls to <strong>str-compare</strong> limit the instance-sets that satisfy the query
to combinations instead of permutations. Without these restrictions, two
instance-sets that differed only in the order of their members would
both satisfy the query.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt;

    (do-for-all-instances ((?p1 PERSON) (?p2 PERSON) (?p3 PERSON))
      (and (= ?p1:age ?p2:age ?p3:age)
      (&gt; (str-compare ?p1 ?p2) 0)
      (&gt; (str-compare ?p2 ?p3) 0))
      (printout t ?p1 &quot; &quot; ?p2 &quot; &quot; ?p3 crlf))

    [Girl-2] [Boy-3] [Boy-2]
    [Girl-2] [Boy-4] [Boy-2]
    [Girl-2] [Boy-4] [Boy-3]
    [Boy-4] [Boy-3] [Boy-2]

    CLIPS&gt;
</pre></div>
</div>
</div>
<div class="section" id="executing-a-delayed-action-for-all-instance-sets-satisfying-a-query">
<h4>9.7.8.6 Executing a Delayed Action for All Instance-sets Satisfying a Query<a class="headerlink" href="#executing-a-delayed-action-for-all-instance-sets-satisfying-a-query" title="Permalink to this headline">¶</a></h4>
<p>This function is similar to <strong>do-for-all-instances</strong> except that it
groups all instance-sets that satisfy the query into an intermediary
multifield value. If there are no instance-sets which satisfy the query,
then the function returns the symbol FALSE. Otherwise, the specified
action is executed for each instance-set in the multifield value, and
the return value is the evaluation of the action for the last
instance-set to satisfy the query. The intermediary multifield value is
discarded. This function can consume large amounts of memory in the same
fashion as <strong>find-all-instances</strong>. This function should be used in lieu
of <strong>do-for-all-instances</strong> when the action applied to one instance-set
would change the result of the query for another instance-set (unless
that is the desired effect).</p>
<p><code class="docutils literal notranslate"><span class="pre">Syntax</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">delayed</span><span class="o">-</span><span class="n">do</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">instances</span> <span class="o">&lt;</span><span class="n">instance</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">template</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">action</span><span class="o">&gt;*</span><span class="p">)</span>
</pre></div>
</div>
<p>Example</p>
<p>Delete all boys with the greatest age. The test in this case is another
query function that determines if there are any older boys than the one
currently being examined. The action needs to be delayed until all boys
have been processed, or the greatest age will decrease as the older boys
are deleted.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CLIPS&gt; (watch instances)
CLIPS&gt;
(delayed-do-for-all-instances ((?b1 BOY))
  (not (any-instancep ((?b2 BOY))
  (&gt; ?b2:age ?b1:age)))
  (send ?b1 delete))
&lt;== instance [Boy-1] of BOY
TRUE
CLIPS&gt; (unwatch instances)
CLIPS&gt; (reset)
CLIPS&gt; (watch instances)
CLIPS&gt;
(do-for-all-instances ((?b1 BOY))
  (not (any-instancep ((?b2 BOY))
  (&gt; ?b2:age ?b1:age)))
  (send ?b1 delete))
&lt;== instance [Boy-1] of BOY
&lt;== instance [Boy-2] of BOY
&lt;== instance [Boy-3] of BOY
&lt;== instance [Boy-4] of BOY
TRUE
CLIPS&gt; (unwatch instances)
CLIPS&gt;
</pre></div>
</div>
<span class="target" id="section-7"></span></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Section 9: CLIPS Object Oriented Language</a><ul>
<li><a class="reference internal" href="#background">9.1 Background</a></li>
<li><a class="reference internal" href="#predefined-system-classes">9.2 Predefined System Classes</a></li>
<li><a class="reference internal" href="#defclass-construct">9.3 Defclass Construct</a><ul>
<li><a class="reference internal" href="#multiple-inheritance">9.3.1 Multiple Inheritance</a><ul>
<li><a class="reference internal" href="#multiple-inheritance-rules">9.3.1.1 Multiple Inheritance Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#class-specifiers">9.3.2 Class Specifiers</a><ul>
<li><a class="reference internal" href="#abstract-and-concrete-classes">9.3.2.1 Abstract and Concrete Classes</a></li>
<li><a class="reference internal" href="#reactive-and-non-reactive-classes">9.3.2.2 Reactive and Non-Reactive Classes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#slots">9.3.3 Slots</a><ul>
<li><a class="reference internal" href="#slot-field-type">9.3.3.1 Slot Field Type</a></li>
<li><a class="reference internal" href="#default-value-facet">9.3.3.2 Default Value Facet</a></li>
<li><a class="reference internal" href="#storage-facet">9.3.3.3 Storage Facet</a></li>
<li><a class="reference internal" href="#access-facet">9.3.3.4 Access Facet</a></li>
<li><a class="reference internal" href="#inheritance-propagation-facet">9.3.3.5 Inheritance Propagation Facet</a></li>
<li><a class="reference internal" href="#source-facet">9.3.3.6 Source Facet</a></li>
<li><a class="reference internal" href="#pattern-match-reactivity-facet">9.3.3.7 Pattern-Match Reactivity Facet</a></li>
<li><a class="reference internal" href="#visibility-facet">9.3.3.8 Visibility Facet</a></li>
<li><a class="reference internal" href="#create-accessor-facet">9.3.3.9 Create-Accessor Facet</a></li>
<li><a class="reference internal" href="#override-message-facet">9.3.3.10 Override-Message Facet</a></li>
<li><a class="reference internal" href="#constraint-facets">9.3.3.11 Constraint Facets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#message-handler-documentation">9.3.4 Message-handler Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#defmessage-handler-construct">9.4 Defmessage-handler Construct</a><ul>
<li><a class="reference internal" href="#message-handler-parameters">9.4.1 Message-handler Parameters</a><ul>
<li><a class="reference internal" href="#active-instance-parameter">9.4.1.1 Active Instance Parameter</a></li>
</ul>
</li>
<li><a class="reference internal" href="#message-handler-actions">9.4.2 Message-handler Actions</a></li>
<li><a class="reference internal" href="#daemons">9.4.3 Daemons</a></li>
<li><a class="reference internal" href="#predefined-system-message-handlers">9.4.4 Predefined System Message-handlers</a><ul>
<li><a class="reference internal" href="#instance-initialization">9.4.4.1 Instance Initialization</a></li>
<li><a class="reference internal" href="#instance-deletion">9.4.4.2 Instance Deletion</a></li>
<li><a class="reference internal" href="#instance-display">9.4.4.3 Instance Display</a></li>
<li><a class="reference internal" href="#directly-modifying-an-instance">9.4.4.4 Directly Modifying an Instance</a></li>
<li><a class="reference internal" href="#modifying-an-instance-using-messages">9.4.4.5 Modifying an Instance using Messages</a></li>
<li><a class="reference internal" href="#directly-duplicating-an-instance">9.4.4.6 Directly Duplicating an Instance</a></li>
<li><a class="reference internal" href="#duplicating-an-instance-using-messages">9.4.4.7 Duplicating an Instance using Messages</a></li>
<li><a class="reference internal" href="#instance-creation">9.4.4.8 Instance Creation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#message-dispatch">9.5 Message Dispatch</a><ul>
<li><a class="reference internal" href="#applicability-of-message-handlers">9.5.1 Applicability of Message-handlers</a></li>
<li><a class="reference internal" href="#message-handler-precedence">9.5.2 Message-handler Precedence</a></li>
<li><a class="reference internal" href="#shadowed-message-handlers">9.5.3 Shadowed Message-handlers</a></li>
<li><a class="reference internal" href="#message-execution-errors">9.5.4 Message Execution Errors</a></li>
<li><a class="reference internal" href="#message-return-value">9.5.5 Message Return Value</a></li>
</ul>
</li>
<li><a class="reference internal" href="#manipulating-instances">9.6 Manipulating Instances</a><ul>
<li><a class="reference internal" href="#creating-instances">9.6.1 Creating Instances</a><ul>
<li><a class="reference internal" href="#definstances-construct">9.6.1.1 Definstances Construct</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reinitializing-existing-instances">9.6.2 Reinitializing Existing Instances</a></li>
<li><a class="reference internal" href="#reading-slots">9.6.3 Reading Slots</a></li>
<li><a class="reference internal" href="#setting-slots">9.6.4 Setting Slots</a></li>
<li><a class="reference internal" href="#deleting-instances">9.6.5 Deleting Instances</a></li>
<li><a class="reference internal" href="#delayed-pattern-matching-when-manipulating-instances">9.6.6 Delayed Pattern-Matching When Manipulating Instances</a></li>
<li><a class="reference internal" href="#modifying-instances">9.6.7 Modifying Instances</a><ul>
<li><a class="reference internal" href="#directly-modifying-an-instance-with-delayed-pattern-matching">9.6.7.1 Directly Modifying an Instance with Delayed Pattern-Matching</a></li>
<li><a class="reference internal" href="#directly-modifying-an-instance-with-immediate-pattern-matching">9.6.7.2 Directly Modifying an Instance with Immediate Pattern-Matching</a></li>
<li><a class="reference internal" href="#modifying-an-instance-using-messages-with-delayed-pattern-matching">9.6.7.3 Modifying an Instance using Messages with Delayed Pattern-Matching</a></li>
<li><a class="reference internal" href="#modifying-an-instance-using-messages-with-immediate-pattern-matching">9.6.7.4 Modifying an Instance using Messages with Immediate Pattern-Matching</a></li>
</ul>
</li>
<li><a class="reference internal" href="#duplicating-instances">9.6.8 Duplicating Instances</a><ul>
<li><a class="reference internal" href="#directly-duplicating-an-instance-with-delayed-pattern-matching">9.6.8.1 Directly Duplicating an Instance with Delayed Pattern-Matching</a></li>
<li><a class="reference internal" href="#directly-duplicating-an-instance-with-immediate-pattern-matching">9.6.8.2 Directly Duplicating an Instance with Immediate Pattern-Matching</a></li>
<li><a class="reference internal" href="#duplicating-an-instance-using-messages-with-delayed-pattern-matching">9.6.8.3 Duplicating an Instance using Messages with Delayed Pattern-Matching</a></li>
<li><a class="reference internal" href="#duplicating-an-instance-using-messages-with-immediate-pattern-matching">9.6.8.4 Duplicating an Instance using Messages with Immediate Pattern-Matching</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#instance-set-queries-and-distributed-actions">9.7 Instance-set Queries and Distributed Actions</a><ul>
<li><a class="reference internal" href="#instance-set-definition">9.7.1 Instance-set Definition</a></li>
<li><a class="reference internal" href="#instance-set-determination">9.7.2 Instance-set Determination</a></li>
<li><a class="reference internal" href="#query-definition">9.7.3 Query Definition</a></li>
<li><a class="reference internal" href="#distributed-action-definition">9.7.4 Distributed Action Definition</a></li>
<li><a class="reference internal" href="#scope-in-instance-set-query-functions">9.7.5 Scope in Instance-set Query Functions</a></li>
<li><a class="reference internal" href="#errors-during-instance-set-query-functions">9.7.6 Errors during Instance-set Query Functions</a></li>
<li><a class="reference internal" href="#halting-and-returning-values-from-query-functions">9.7.7 Halting and Returning Values from Query Functions</a></li>
<li><a class="reference internal" href="#instance-set-query-functions">9.7.8 Instance-set Query Functions</a><ul>
<li><a class="reference internal" href="#testing-if-any-instance-set-satisfies-a-query">9.7.8.1 Testing if Any Instance-set Satisfies a Query</a></li>
<li><a class="reference internal" href="#determining-the-first-instance-set-satisfying-a-query">9.7.8.2 Determining the First Instance-set Satisfying a Query</a></li>
<li><a class="reference internal" href="#determining-all-instance-sets-satisfying-a-query">9.7.8.3 Determining All Instance-sets Satisfying a Query</a></li>
<li><a class="reference internal" href="#executing-an-action-for-the-first-instance-set-satisfying-a-query">9.7.8.4 Executing an Action for the First Instance-set Satisfying a Query</a></li>
<li><a class="reference internal" href="#executing-an-action-for-all-instance-sets-satisfying-a-query">9.7.8.5 Executing an Action for All Instance-sets Satisfying a Query</a></li>
<li><a class="reference internal" href="#executing-a-delayed-action-for-all-instance-sets-satisfying-a-query">9.7.8.6 Executing a Delayed Action for All Instance-sets Satisfying a Query</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="generic.html"
                        title="previous chapter">Section 8: Generic Functions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="defmodule.html"
                        title="next chapter">Section 10: Defmodule Construct</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/cool.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="defmodule.html" title="Section 10: Defmodule Construct"
             >next</a> |</li>
        <li class="right" >
          <a href="generic.html" title="Section 8: Generic Functions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CLIPS-BPG  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Kurt Pagani &lt;nilqed@gmail.com&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>